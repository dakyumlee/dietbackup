<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyDiet - ë°”ë”” íŠ¸ë˜í‚¹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-brand {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .page-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .tracking-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .tracking-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-area {
            border: 3px dashed #e2e8f0;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: #e6f3ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 16px;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 14px;
            color: #718096;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .preview-container {
            display: none;
            margin-top: 20px;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .image-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .analysis-results {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f0f9ff;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .inbody-form {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2d3748;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .progress-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }

        .comparison-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2d3748;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .trend-up {
            background: #fef2f2;
            color: #dc2626;
        }

        .trend-down {
            background: #f0fdf4;
            color: #16a34a;
        }

        .trend-stable {
            background: #fef3c7;
            color: #d97706;
        }

        .ai-analysis {
            background: linear-gradient(135deg, #f0f9ff, #e0e7ff);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .ai-title {
            font-size: 18px;
            font-weight: 600;
            color: #3730a3;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-content {
            color: #4338ca;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .tracking-grid {
                grid-template-columns: 1fr;
            }
            
            .inbody-form {
                grid-template-columns: 1fr;
            }
            
            .form-group.full-width {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <a href="#" class="nav-brand">
                <span>ğŸ</span>
                MyDiet
            </a>
            <div class="nav-actions">
                <a href="dashboard.html" class="back-btn">
                    â† ëŒ€ì‹œë³´ë“œë¡œ
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">ğŸ“¸ ë°”ë”” íŠ¸ë˜í‚¹</h1>
            <p class="page-subtitle">ì‹ ì²´ ë³€í™”ë¥¼ ê¸°ë¡í•˜ê³  AIê°€ ë¶„ì„í•œ ë§ì¶¤í˜• í”¼ë“œë°±ì„ ë°›ì•„ë³´ì„¸ìš”</p>
        </div>

        <div class="tracking-grid">
            <div class="tracking-card">
                <h2 class="card-title">ğŸ“· ëˆˆë°”ë”” ì´¬ì˜</h2>
                
                <div class="upload-area" id="body-photo-upload" onclick="triggerFileInput('body-photo-input')">
                    <div class="upload-icon">ğŸ“¸</div>
                    <div class="upload-text">ì „ì‹  ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                    <div class="upload-hint">ê¶Œì¥: ì •ë©´, ì¸¡ë©´, í›„ë©´ ì‚¬ì§„ (JPG, PNG)</div>
                    <button class="upload-btn">ì‚¬ì§„ ì„ íƒí•˜ê¸°</button>
                </div>
                
                <input type="file" id="body-photo-input" style="display: none;" accept="image/*" multiple onchange="handleBodyPhotoUpload(event)">
                
                <div class="preview-container" id="body-photo-preview">
                    <img class="preview-image" id="preview-img" alt="ë¯¸ë¦¬ë³´ê¸°">
                    <div class="image-actions">
                        <button class="action-btn btn-primary" onclick="analyzeBodyPhoto()">ğŸ¤– AI ë¶„ì„</button>
                        <button class="action-btn btn-secondary" onclick="retakePhoto()">ğŸ”„ ë‹¤ì‹œ ì´¬ì˜</button>
                        <button class="action-btn btn-danger" onclick="deletePhoto()">ğŸ—‘ï¸ ì‚­ì œ</button>
                    </div>
                </div>
                
                <div class="analysis-results" id="body-analysis-results">
                    <h4>ğŸ¯ AI ë¶„ì„ ê²°ê³¼</h4>
                    <div id="body-analysis-content"></div>
                </div>
            </div>

            <div class="tracking-card">
                <h2 class="card-title">ğŸ“Š ì¸ë°”ë”” ë°ì´í„° ì…ë ¥</h2>
                
                <form class="inbody-form" onsubmit="saveInbodyData(event)">
                    <div class="form-group">
                        <label class="form-label">ì²´ì¤‘ (kg)</label>
                        <input type="number" id="weight" class="form-input" step="0.1" placeholder="65.5" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì²´ì§€ë°©ë¥  (%)</label>
                        <input type="number" id="body-fat" class="form-input" step="0.1" placeholder="18.5">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ê³¨ê²©ê·¼ëŸ‰ (kg)</label>
                        <input type="number" id="muscle-mass" class="form-input" step="0.1" placeholder="28.3">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ìˆ˜ë¶„ëŸ‰ (%)</label>
                        <input type="number" id="water-content" class="form-input" step="0.1" placeholder="60.2">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ê¸°ì´ˆëŒ€ì‚¬ìœ¨ (kcal)</label>
                        <input type="number" id="bmr" class="form-input" placeholder="1650">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ë‚´ì¥ì§€ë°© ë ˆë²¨</label>
                        <input type="number" id="visceral-fat" class="form-input" min="1" max="20" placeholder="5">
                    </div>
                    
                    <div class="form-group full-width">
                        <label class="form-label">ë©”ëª¨</label>
                        <input type="text" id="inbody-memo" class="form-input" placeholder="ì¸¡ì • ì¥ì†Œ, ì»¨ë””ì…˜ ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”">
                    </div>
                    
                    <div class="form-group full-width">
                        <button type="submit" class="submit-btn">ğŸ“Š ì¸ë°”ë”” ë°ì´í„° ì €ì¥</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="progress-section">
            <h2 class="card-title">ğŸ“ˆ ë³€í™” ì¶”ì´ ë¶„ì„</h2>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>í•­ëª©</th>
                        <th>ìµœì´ˆ ì¸¡ì •</th>
                        <th>ìµœê·¼ ì¸¡ì •</th>
                        <th>ë³€í™”ëŸ‰</th>
                        <th>ì¶”ì„¸</th>
                    </tr>
                </thead>
                <tbody id="comparison-data">
                    <tr>
                        <td>ì²´ì¤‘</td>
                        <td>68.5kg</td>
                        <td>65.2kg</td>
                        <td>-3.3kg</td>
                        <td><span class="trend-indicator trend-down">â¬‡ï¸ ê°ì†Œ</span></td>
                    </tr>
                    <tr>
                        <td>ì²´ì§€ë°©ë¥ </td>
                        <td>22.1%</td>
                        <td>18.5%</td>
                        <td>-3.6%</td>
                        <td><span class="trend-indicator trend-down">â¬‡ï¸ ê°ì†Œ</span></td>
                    </tr>
                    <tr>
                        <td>ê³¨ê²©ê·¼ëŸ‰</td>
                        <td>26.8kg</td>
                        <td>28.3kg</td>
                        <td>+1.5kg</td>
                        <td><span class="trend-indicator trend-up">â¬†ï¸ ì¦ê°€</span></td>
                    </tr>
                </tbody>
            </table>

            <div class="ai-analysis">
                <h3 class="ai-title">ğŸ¤– Claude AI ì¢…í•© ë¶„ì„</h3>
                <div class="ai-content">
                    <p>í›Œë¥­í•œ ì§„ì „ì„ ë³´ì´ê³  ê³„ì‹œë„¤ìš”! ìµœê·¼ ë°ì´í„°ë¥¼ ë¶„ì„í•œ ê²°ê³¼:</p>
                    <br>
                    <p>âœ… <strong>ì²´ì¤‘ ê°ì†Œ:</strong> ê±´ê°•í•œ ì†ë„ë¡œ ê°ì†Œí•˜ê³  ìˆìœ¼ë©°, ê·¼ìœ¡ëŸ‰ì€ ì˜¤íˆë ¤ ì¦ê°€í–ˆìŠµë‹ˆë‹¤.</p>
                    <p>ğŸ’ª <strong>ê·¼ìœ¡ ë°œë‹¬:</strong> ê³¨ê²©ê·¼ëŸ‰ ì¦ê°€ëŠ” ê·œì¹™ì ì¸ ê·¼ë ¥ ìš´ë™ì˜ ê²°ê³¼ì…ë‹ˆë‹¤.</p>
                    <p>ğŸ¯ <strong>ëª©í‘œ ë‹¬ì„±:</strong> í˜„ì¬ ì§„í–‰ ì†ë„ë¡œ 8-10ì£¼ í›„ ëª©í‘œ ë‹¬ì„± ì˜ˆìƒë©ë‹ˆë‹¤.</p>
                    <p>âš ï¸ <strong>ì£¼ì˜ì‚¬í•­:</strong> ë‹¨ë°±ì§ˆ ì„­ì·¨ëŸ‰ì„ ëŠ˜ë ¤ ê·¼ìœ¡ ì†ì‹¤ì„ ë°©ì§€í•˜ì„¸ìš”.</p>
                    <br>
                    <p><strong>ë‹¤ìŒ ì£¼ ê¶Œì¥ì‚¬í•­:</strong> í˜„ì¬ ìš´ë™ ë£¨í‹´ ìœ ì§€, ë‹¨ë°±ì§ˆ í•˜ë£¨ 120g ì„­ì·¨, ì¶©ë¶„í•œ ìˆ˜ë©´</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class BodyTrackingSystem {
            constructor() {
                this.bodyPhotos = [];
                this.inbodyData = [];
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadStoredData();
            }

            setupEventListeners() {
                const uploadArea = document.getElementById('body-photo-upload');
                
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    this.handleFiles(e.dataTransfer.files);
                });
            }

            handleFiles(files) {
                Array.from(files).forEach(file => {
                    if (file.type.startsWith('image/')) {
                        this.previewImage(file);
                    }
                });
            }

            previewImage(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('preview-img').src = e.target.result;
                    document.getElementById('body-photo-preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }

            analyzeBodyPhoto() {
                const analysisResults = document.getElementById('body-analysis-results');
                const analysisContent = document.getElementById('body-analysis-content');
                
                analysisContent.innerHTML = `
                    <div style="margin: 15px 0;">
                        <h5>ğŸ“Š ìì„¸ ë¶„ì„</h5>
                        <p>â€¢ ì–´ê¹¨ ë†’ì´: ì¢Œìš° ê· í˜• ì–‘í˜¸</p>
                        <p>â€¢ ê³¨ë°˜ ì •ë ¬: ì•½ê°„ ì•ìœ¼ë¡œ ê¸°ìš¸ì–´ì§ (ê°œì„  ê¶Œì¥)</p>
                        <p>â€¢ ì „ì²´ì ì¸ ìì„¸: B+ ë“±ê¸‰</p>
                    </div>
                    <div style="margin: 15px 0;">
                        <h5>ğŸ’ª ì²´í˜• ë³€í™” ê°ì§€</h5>
                        <p>â€¢ ë³µë¶€ ë‘˜ë ˆ: ì´ì „ ëŒ€ë¹„ ì•½ 3cm ê°ì†Œ ì¶”ì •</p>
                        <p>â€¢ í—ˆë²…ì§€ ê·¼ìœ¡: ì„ ëª…ë„ ì¦ê°€</p>
                        <p>â€¢ ì „ì²´ì ì¸ ë³€í™”: ê¸ì •ì  ë°œì „</p>
                    </div>
                    <div style="margin: 15px 0;">
                        <h5>ğŸ¯ ê°œì„  ì œì•ˆ</h5>
                        <p>â€¢ ì½”ì–´ ê°•í™” ìš´ë™ ì¶”ê°€ ê¶Œì¥</p>
                        <p>â€¢ í•˜ì²´ ê·¼ë ¥ ìš´ë™ ì§€ì†</p>
                        <p>â€¢ ì •ê¸°ì ì¸ ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ ìì„¸ êµì •</p>
                    </div>
                `;
                
                analysisResults.style.display = 'block';
                
                this.bodyPhotos.push({
                    image: document.getElementById('preview-img').src,
                    analysis: analysisContent.innerHTML,
                    date: new Date(),
                    id: Date.now()
                });
                
                this.saveData();
                this.sendToMyDiet();
            }

            sendToMyDiet() {
                if (window.opener) {
                    window.opener.postMessage({
                        type: 'BODY_PHOTO_SAVED',
                        data: this.bodyPhotos[this.bodyPhotos.length - 1]
                    }, '*');
                }
            }

            saveInbodyData(event) {
                event.preventDefault();
                
                const data = {
                    weight: parseFloat(document.getElementById('weight').value),
                    bodyFat: parseFloat(document.getElementById('body-fat').value) || null,
                    muscleMass: parseFloat(document.getElementById('muscle-mass').value) || null,
                    waterContent: parseFloat(document.getElementById('water-content').value) || null,
                    bmr: parseInt(document.getElementById('bmr').value) || null,
                    visceralFat: parseInt(document.getElementById('visceral-fat').value) || null,
                    memo: document.getElementById('inbody-memo').value,
                    date: new Date(),
                    id: Date.now()
                };

                this.inbodyData.push(data);
                this.saveData();
                this.updateComparison();
                this.showToast('ì¸ë°”ë”” ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                if (window.opener) {
                    window.opener.postMessage({
                        type: 'INBODY_DATA_SAVED',
                        data: data
                    }, '*');
                }
                
                event.target.reset();
            }

            updateComparison() {
                if (this.inbodyData.length < 2) return;

                const first = this.inbodyData[0];
                const latest = this.inbodyData[this.inbodyData.length - 1];
                const tbody = document.getElementById('comparison-data');

                const rows = [
                    {
                        item: 'ì²´ì¤‘',
                        first: first.weight + 'kg',
                        latest: latest.weight + 'kg',
                        change: (latest.weight - first.weight).toFixed(1) + 'kg',
                        trend: latest.weight < first.weight ? 'down' : latest.weight > first.weight ? 'up' : 'stable'
                    },
                    {
                        item: 'ì²´ì§€ë°©ë¥ ',
                        first: (first.bodyFat || 0) + '%',
                        latest: (latest.bodyFat || 0) + '%',
                        change: ((latest.bodyFat || 0) - (first.bodyFat || 0)).toFixed(1) + '%',
                        trend: (latest.bodyFat || 0) < (first.bodyFat || 0) ? 'down' : (latest.bodyFat || 0) > (first.bodyFat || 0) ? 'up' : 'stable'
                    },
                    {
                        item: 'ê³¨ê²©ê·¼ëŸ‰',
                        first: (first.muscleMass || 0) + 'kg',
                        latest: (latest.muscleMass || 0) + 'kg',
                        change: ((latest.muscleMass || 0) - (first.muscleMass || 0)).toFixed(1) + 'kg',
                        trend: (latest.muscleMass || 0) > (first.muscleMass || 0) ? 'up' : (latest.muscleMass || 0) < (first.muscleMass || 0) ? 'down' : 'stable'
                    }
                ];

                tbody.innerHTML = rows.map(row => `
                    <tr>
                        <td>${row.item}</td>
                        <td>${row.first}</td>
                        <td>${row.latest}</td>
                        <td>${row.change.startsWith('-') ? '' : row.change.startsWith('0') ? '' : '+'}${row.change}</td>
                        <td><span class="trend-indicator trend-${row.trend}">
                            ${row.trend === 'up' ? 'â¬†ï¸ ì¦ê°€' : row.trend === 'down' ? 'â¬‡ï¸ ê°ì†Œ' : 'â– ìœ ì§€'}
                        </span></td>
                    </tr>
                `).join('');
            }

            showToast(message) {
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #10b981;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    z-index: 1000;
                    font-weight: 500;
                `;
                toast.textContent = message;
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }

            saveData() {
                localStorage.setItem('mydiet-body-tracking', JSON.stringify({
                    bodyPhotos: this.bodyPhotos,
                    inbodyData: this.inbodyData
                }));
            }

            loadStoredData() {
                const stored = localStorage.getItem('mydiet-body-tracking');
                if (stored) {
                    const data = JSON.parse(stored);
                    this.bodyPhotos = data.bodyPhotos || [];
                    this.inbodyData = data.inbodyData || [];
                    this.updateComparison();
                }
            }
        }

        function triggerFileInput(inputId) {
            document.getElementById(inputId).click();
        }

        function handleBodyPhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                bodyTracking.previewImage(file);
            }
        }

        function analyzeBodyPhoto() {
            bodyTracking.analyzeBodyPhoto();
        }

        function retakePhoto() {
            document.getElementById('body-photo-input').click();
        }

        function deletePhoto() {
            document.getElementById('body-photo-preview').style.display = 'none';
            document.getElementById('body-analysis-results').style.display = 'none';
            document.getElementById('body-photo-input').value = '';
        }

        function saveInbodyData(event) {
            bodyTracking.saveInbodyData(event);
        }

        const bodyTracking = new BodyTrackingSystem();
    </script>
</body>
</html>