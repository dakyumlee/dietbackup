<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyDiet - ëŒ€ì‹œë³´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        body.dark {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .theme-toggle::before {
            content: 'â˜€ï¸';
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        body.dark .theme-toggle::before {
            content: 'ğŸŒ™';
            transform: translateX(30px);
            background: #1e293b;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        body.dark .header {
            background: rgba(30, 41, 59, 0.95);
            color: #e2e8f0;
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        body.dark .header h1 {
            background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        body.dark .header p {
            color: #94a3b8;
        }

        .user-welcome {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        body.dark .user-welcome {
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
        }

        .user-welcome::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .user-welcome h2 {
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .user-welcome p {
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.8);
            transform: translateY(-2px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .main-dashboard {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        body.dark .stat-card {
            background: #1e293b;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        body.dark .stat-card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            counter-reset: stat-counter 0;
            animation: countUp 2s ease-out;
        }

        body.dark .stat-value {
            color: #e2e8f0;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        body.dark .stat-label {
            color: #94a3b8;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        body.dark .main-content {
            background: #1e293b;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        body.dark .sidebar-card {
            background: #1e293b;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        body.dark .section-header {
            border-bottom-color: #334155;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
        }

        body.dark .section-title {
            color: #e2e8f0;
        }

        .add-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .data-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
            position: relative;
            overflow: hidden;
        }

        body.dark .data-card {
            background: #334155;
            color: #e2e8f0;
        }

        .data-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .data-card:hover::before {
            left: 100%;
        }

        .data-card:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        body.dark .data-card:hover {
            background: #475569;
        }

        .data-card h4 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        body.dark .data-card h4 {
            color: #e2e8f0;
        }

        .data-card p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        body.dark .data-card p {
            color: #94a3b8;
        }

        .data-actions {
            display: flex;
            gap: 10px;
        }

        .edit-btn, .delete-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: #28a745;
            color: white;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .edit-btn:hover, .delete-btn:hover {
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }

        body.dark .empty-state {
            background: #334155;
            border-color: #475569;
            color: #94a3b8;
        }

        .empty-state .emoji {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .empty-state p {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .goal-progress {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        body.dark .goal-progress {
            background: #1e293b;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .goal-progress h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3rem;
        }

        body.dark .goal-progress h3 {
            color: #e2e8f0;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 12px;
            height: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }

        body.dark .progress-bar {
            background: #475569;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.8s ease;
            border-radius: 12px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        .progress-text {
            font-size: 1rem;
            color: #666;
            text-align: center;
            font-weight: 500;
        }

        body.dark .progress-text {
            color: #94a3b8;
        }

        .nutrition-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .nutrition-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        body.dark .nutrition-item {
            background: #334155;
        }

        .nutrition-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .nutrition-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        body.dark .nutrition-value {
            color: #818cf8;
        }

        .nutrition-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        body.dark .nutrition-label {
            color: #94a3b8;
        }

        .bmi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        body.dark .bmi-card {
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
        }

        .bmi-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255,255,255,0.1), transparent 30%);
            animation: rotate 6s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .bmi-card > * {
            position: relative;
            z-index: 1;
        }

        .bmi-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .bmi-status {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .health-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        body.dark .metric-item {
            background: #334155;
        }

        .metric-item:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .metric-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }

        body.dark .metric-value {
            color: #e2e8f0;
        }

        .metric-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        body.dark .metric-label {
            color: #94a3b8;
        }

        .profile-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        body.dark .profile-info {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            border-color: #475569;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin: 0 auto 15px;
        }

        .profile-name {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        body.dark .profile-name {
            color: #e2e8f0;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            text-align: center;
        }

        .profile-stat {
            padding: 8px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
        }

        .profile-stat-value {
            font-weight: bold;
            color: #667eea;
        }

        .profile-stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        body.dark .profile-stat-label {
            color: #94a3b8;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            margin: 20px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.7);
            opacity: 0;
            transition: all 0.3s ease;
        }

        body.dark .modal-content {
            background: #1e293b;
            color: #e2e8f0;
        }

        .modal.show .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        body.dark .modal-header {
            border-bottom-color: #334155;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        body.dark .modal-title {
            color: #e2e8f0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #999;
            cursor: pointer;
            padding: 5px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark .close-btn:hover {
            background: #334155;
            color: #e2e8f0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        body.dark .form-group label {
            color: #e2e8f0;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            outline: none;
            transition: all 0.3s ease;
            font-size: 1rem;
            background: white;
        }

        body.dark .form-group input,
        body.dark .form-group select,
        body.dark .form-group textarea {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 3000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.error {
            background: #dc3545;
        }

        .claude-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        body.dark .claude-section {
            background: #1e293b;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .claude-response {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 12px;
            font-style: italic;
            color: #555;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
            line-height: 1.6;
            position: relative;
            overflow: hidden;
        }

        body.dark .claude-response {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            color: #e2e8f0;
        }

        .claude-response::before {
            content: '"';
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 3rem;
            color: #667eea;
            opacity: 0.3;
        }

        .ai-chat-container {
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 20px;
        }

        body.dark .ai-chat-container {
            border-color: #334155;
        }

        .ai-chat-messages {
            height: 350px;
            overflow-y: auto;
            padding: 20px;
            background: #fafafa;
        }

        body.dark .ai-chat-messages {
            background: #334155;
        }

        .ai-message {
            display: flex;
            margin-bottom: 20px;
            align-items: flex-start;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-message.user-message {
            flex-direction: row-reverse;
        }

        .ai-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin: 0 12px;
            flex-shrink: 0;
        }

        .ai-message:not(.user-message) .ai-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .ai-message.user-message .ai-avatar {
            background: #28a745;
            color: white;
        }

        .ai-text {
            background: white;
            padding: 15px 20px;
            border-radius: 18px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 75%;
            word-wrap: break-word;
            line-height: 1.5;
            position: relative;
        }

        body.dark .ai-text {
            background: #1e293b;
            color: #e2e8f0;
        }

        .ai-message.user-message .ai-text {
            background: #007bff;
            color: white;
        }

        .ai-input-container {
            display: flex;
            padding: 20px;
            background: white;
            border-top: 1px solid #f0f0f0;
        }

        body.dark .ai-input-container {
            background: #1e293b;
            border-top-color: #334155;
        }

        .ai-input-container input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            margin-right: 15px;
            transition: border-color 0.3s ease;
            background: white;
        }

        body.dark .ai-input-container input {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }

        .ai-input-container input:focus {
            border-color: #667eea;
        }

        .ai-send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .ai-send-btn:hover {
            transform: scale(1.05);
        }

        .ai-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 15px 20px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .quick-action {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        body.dark .quick-action {
            background: #334155;
        }

        .quick-action::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 50%;
            transition: all 0.6s ease;
            transform: translate(-50%, -50%);
        }

        .quick-action:hover::before {
            width: 300px;
            height: 300px;
        }

        .quick-action:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .quick-action .icon {
            font-size: 2rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .quick-action div:last-child {
            position: relative;
            z-index: 1;
        }

        .weekly-summary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .weekly-summary h3 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .summary-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .health-metrics {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10px;
                padding: 20px;
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 50px;
                height: 25px;
            }

            .theme-toggle::before {
                width: 21px;
                height: 21px;
                font-size: 10px;
            }

            body.dark .theme-toggle::before {
                transform: translateX(25px);
            }
        }
    </style>
</head>
<body>
    <div class="theme-toggle" onclick="toggleTheme()"></div>

    <div class="container">
        <div class="header">
            <h1>ğŸ MyDiet</h1>
            <p>AIì™€ í•¨ê»˜í•˜ëŠ” ìŠ¤ë§ˆíŠ¸í•œ ê±´ê°• ê´€ë¦¬</p>
        </div>

        <div class="user-welcome">
            <h2 id="user-nickname-display">í…ŒìŠ¤íŠ¸ìœ ì €ë‹˜, ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹</h2>
            <p id="goal-message">ëª©í‘œ ì²´ì¤‘ 65kgì„ í–¥í•´ í•¨ê»˜ ë‹¬ë ¤ë´ìš”!</p>
            <button class="refresh-btn" onclick="refreshDashboard()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <div class="dashboard-grid">
            <div class="main-dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ½ï¸</div>
                        <div class="stat-value" id="meal-count">0</div>
                        <div class="stat-label">ì˜¤ëŠ˜ ì‹ë‹¨ ê¸°ë¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸƒ</div>
                        <div class="stat-value" id="workout-count">0</div>
                        <div class="stat-label">ì˜¤ëŠ˜ ìš´ë™ ê¸°ë¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ˜Š</div>
                        <div class="stat-value" id="emotion-count">0</div>
                        <div class="stat-label">ê°ì • ê¸°ë¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-value" id="goal-achievement">0%</div>
                        <div class="stat-label">ëª©í‘œ ë‹¬ì„±ë¥ </div>
                    </div>
                </div>

                <div class="goal-progress">
                    <h3>ğŸ“Š ì˜¤ëŠ˜ì˜ ëª©í‘œ ë‹¬ì„±ë¥ </h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="progress-text">ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ í™”ì´íŒ…!</div>
                    
                    <div class="nutrition-overview">
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="total-calories">0</div>
                            <div class="nutrition-label">ì„­ì·¨ ì¹¼ë¡œë¦¬</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="burned-calories">0</div>
                            <div class="nutrition-label">ì†Œëª¨ ì¹¼ë¡œë¦¬</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="net-calories">0</div>
                            <div class="nutrition-label">ìˆœ ì¹¼ë¡œë¦¬</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="water-intake">0L</div>
                            <div class="nutrition-label">ìˆ˜ë¶„ ì„­ì·¨</div>
                        </div>
                    </div>
                </div>

                <div class="main-content">
                    <div class="section-header">
                        <h3 class="section-title">ğŸ½ï¸ ì˜¤ëŠ˜ì˜ ì‹ë‹¨</h3>
                        <button class="add-btn" onclick="openMealModal()">+ ì‹ë‹¨ ì¶”ê°€</button>
                    </div>
                    <div class="data-grid" id="meal-list">
                        <div class="empty-state">
                            <div class="emoji">ğŸ½ï¸</div>
                            <p>ì•„ì§ ê¸°ë¡ëœ ì‹ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤</p>
                            <button class="add-btn" onclick="openMealModal()">ì²« ì‹ë‹¨ ê¸°ë¡í•˜ê¸°</button>
                        </div>
                    </div>

                    <div class="section-header" style="margin-top: 40px;">
                        <h3 class="section-title">ğŸƒ ì˜¤ëŠ˜ì˜ ìš´ë™</h3>
                        <button class="add-btn" onclick="openWorkoutModal()">+ ìš´ë™ ì¶”ê°€</button>
                    </div>
                    <div class="data-grid" id="workout-list">
                        <div class="empty-state">
                            <div class="emoji">ğŸƒ</div>
                            <p>ì•„ì§ ê¸°ë¡ëœ ìš´ë™ì´ ì—†ìŠµë‹ˆë‹¤</p>
                            <button class="add-btn" onclick="openWorkoutModal()">ì²« ìš´ë™ ê¸°ë¡í•˜ê¸°</button>
                        </div>
                    </div>

                    <div class="section-header" style="margin-top: 40px;">
                        <h3 class="section-title">ğŸ˜Š ì˜¤ëŠ˜ì˜ ê°ì •</h3>
                        <button class="add-btn" onclick="openEmotionModal()">+ ê°ì • ì¶”ê°€</button>
                    </div>
                    <div class="data-grid" id="emotion-list">
                        <div class="empty-state">
                            <div class="emoji">ğŸ˜Š</div>
                            <p>ì•„ì§ ê¸°ë¡ëœ ê°ì •ì´ ì—†ìŠµë‹ˆë‹¤</p>
                            <button class="add-btn" onclick="openEmotionModal()">ì²« ê°ì • ê¸°ë¡í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="profile-info">
                    <div class="profile-avatar" id="profile-avatar">ğŸ‘¤</div>
                    <div class="profile-name" id="profile-name">í…ŒìŠ¤íŠ¸ ìœ ì €</div>
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profile-height">170cm</div>
                            <div class="profile-stat-label">í‚¤</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profile-age">25ì„¸</div>
                            <div class="profile-stat-label">ë‚˜ì´</div>
                        </div>
                    </div>
                </div>

                <div class="bmi-card">
                    <h3>ğŸ“ BMI ì§€ìˆ˜</h3>
                    <div class="bmi-value" id="bmi-value">22.5</div>
                    <div class="bmi-status" id="bmi-status">ì •ìƒ ì²´ì¤‘</div>
                    <div style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                        ê±´ê°•í•œ ì²´ì¤‘ì„ ìœ ì§€í•˜ê³  ìˆì–´ìš”! ğŸ‘
                    </div>
                </div>

                <div class="sidebar-card">
                    <h3 style="text-align: center; margin-bottom: 20px;">âš–ï¸ ë‚˜ì˜ í˜„ì¬ ìƒíƒœ</h3>
                    
                    <div class="health-metrics">
                        <div class="metric-item">
                            <div class="metric-value" id="current-weight">70kg</div>
                            <div class="metric-label">í˜„ì¬ ì²´ì¤‘</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value" id="goal-weight">65kg</div>
                            <div class="metric-label">ëª©í‘œ ì²´ì¤‘</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value" id="weight-diff">-5kg</div>
                            <div class="metric-label">ë‚¨ì€ ëª©í‘œ</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value" id="days-left">30ì¼</div>
                            <div class="metric-label">ëª©í‘œ ê¸°ê°„</div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="quick-action" onclick="openProfileModal()">
                            <div class="icon">âš™ï¸</div>
                            <div>ì„¤ì •</div>
                        </div>
                        <div class="quick-action" onclick="openWeightModal()">
                            <div class="icon">âš–ï¸</div>
                            <div>ì²´ì¤‘ê¸°ë¡</div>
                        </div>
                        <div class="quick-action" onclick="deleteAllTodayData()" style="border-color: #dc3545;">
                            <div class="icon" style="color: #dc3545;">ğŸ—‘ï¸</div>
                            <div style="color: #dc3545;">ì „ì²´ì‚­ì œ</div>
                        </div>
                    </div>
                </div>

                <div class="weekly-summary">
                    <h3>ğŸ“ˆ ì´ë²ˆ ì£¼ ìš”ì•½</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-value">1,850</div>
                            <div class="summary-label">í‰ê·  ì¹¼ë¡œë¦¬</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">4íšŒ</div>
                            <div class="summary-label">ìš´ë™ íšŸìˆ˜</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">80%</div>
                            <div class="summary-label">ëª©í‘œ ë‹¬ì„±</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">ì¢‹ìŒ</div>
                            <div class="summary-label">í‰ê·  ê¸°ë¶„</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="claude-section">
            <h2 style="text-align: center; margin-bottom: 25px; color: #333;">ğŸ¤– Claude AI ê±´ê°• ì½”ì¹˜</h2>
            
            <div class="claude-response" id="claude-response">
                ì˜¤ëŠ˜ë„ ê±´ê°•í•œ í•˜ë£¨ë¥¼ ìœ„í•´ í•¨ê»˜í•´ìš”! ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ì„±ê³µì˜ ì—´ì‡ ì…ë‹ˆë‹¤. ğŸ’ª
            </div>
            
            <h3 style="margin-bottom: 15px; color: #333;">ğŸ’¬ Claudeì—ê²Œ ë¬¼ì–´ë³´ì„¸ìš”</h3>
            <div class="ai-chat-container">
                <div id="ai-chat-messages" class="ai-chat-messages">
                    <div class="ai-message">
                        <div class="ai-avatar">ğŸ¤–</div>
                        <div class="ai-text">ì•ˆë…•í•˜ì„¸ìš”! ê±´ê°• ê´€ë¦¬ë‚˜ ë‹¤ì´ì–´íŠ¸ì— ëŒ€í•´ ê¶ê¸ˆí•œ ê²ƒì´ ìˆìœ¼ë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”! ì˜¤ëŠ˜ì˜ ì‹ë‹¨ì´ë‚˜ ìš´ë™ ê³„íšì— ëŒ€í•´ì„œë„ ì¡°ì–¸í•´ë“œë¦´ ìˆ˜ ìˆì–´ìš”.</div>
                    </div>
                </div>
                <div class="ai-input-container">
                    <input type="text" id="ai-question-input" placeholder="Claudeì—ê²Œ ì§ˆë¬¸í•˜ì„¸ìš”... (ì˜ˆ: ì˜¤ëŠ˜ ë¨¹ì€ ìŒì‹ ì–´ë•Œ? / ë‹¤ì´ì–´íŠ¸ íŒ ì•Œë ¤ì¤˜)" onkeypress="handleEnterKey(event)">
                    <button class="ai-send-btn" onclick="askClaude()">ì „ì†¡</button>
                </div>
            </div>
        </div>
    </div>

    <div id="mealModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ½ï¸ ì‹ë‹¨ ê¸°ë¡</h2>
                <button class="close-btn" onclick="closeMealModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="meal-description">ì‹ë‹¨ ì„¤ëª…</label>
                <input type="text" id="meal-description" placeholder="ì˜ˆ: ì•„ì¹¨ - í˜„ë¯¸ë°¥, ê¹€ì¹˜ì°Œê°œ, ê³„ë€í›„ë¼ì´" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="meal-calories">ì¹¼ë¡œë¦¬ (kcal)</label>
                    <input type="number" id="meal-calories" placeholder="ì˜ˆ: 450" min="1" required>
                </div>
                <div class="form-group">
                    <label for="meal-time">ì‹ì‚¬ ì‹œê°„</label>
                    <select id="meal-time">
                        <option value="ì•„ì¹¨">ì•„ì¹¨</option>
                        <option value="ì ì‹¬">ì ì‹¬</option>
                        <option value="ì €ë…">ì €ë…</option>
                        <option value="ê°„ì‹">ê°„ì‹</option>
                    </select>
                </div>
            </div>
            <button class="submit-btn" onclick="saveMeal()">ì‹ë‹¨ ê¸°ë¡í•˜ê¸°</button>
        </div>
    </div>

    <div id="workoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸƒ ìš´ë™ ê¸°ë¡</h2>
                <button class="close-btn" onclick="closeWorkoutModal()">&times;</button>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="workout-type">ìš´ë™ ì¢…ë¥˜</label>
                    <select id="workout-type" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ê±·ê¸°">ê±·ê¸°</option>
                        <option value="ì¡°ê¹…">ì¡°ê¹…</option>
                        <option value="ë‹¬ë¦¬ê¸°">ë‹¬ë¦¬ê¸°</option>
                        <option value="ìì „ê±°">ìì „ê±°</option>
                        <option value="ìˆ˜ì˜">ìˆ˜ì˜</option>
                        <option value="í—¬ìŠ¤">í—¬ìŠ¤ (ê·¼ë ¥ìš´ë™)</option>
                        <option value="ìš”ê°€">ìš”ê°€</option>
                        <option value="í•„ë¼í…ŒìŠ¤">í•„ë¼í…ŒìŠ¤</option>
                        <option value="ë“±ì‚°">ë“±ì‚°</option>
                        <option value="ì¶•êµ¬">ì¶•êµ¬</option>
                        <option value="ë†êµ¬">ë†êµ¬</option>
                        <option value="í…Œë‹ˆìŠ¤">í…Œë‹ˆìŠ¤</option>
                        <option value="ë°°ë“œë¯¼í„´">ë°°ë“œë¯¼í„´</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="workout-duration">ì‹œê°„ (ë¶„)</label>
                    <input type="number" id="workout-duration" placeholder="ì˜ˆ: 30" min="1" required>
                </div>
            </div>
            <div class="form-group">
                <label for="workout-intensity">ìš´ë™ ê°•ë„</label>
                <select id="workout-intensity">
                    <option value="ë‚®ìŒ">ë‚®ìŒ (ê°€ë²¼ìš´ ìš´ë™)</option>
                    <option value="ë³´í†µ" selected>ë³´í†µ (ì ë‹¹í•œ ìš´ë™)</option>
                    <option value="ë†’ìŒ">ë†’ìŒ (ê²©ë ¬í•œ ìš´ë™)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="workout-note">ìš´ë™ ë©”ëª¨ (ì„ íƒì‚¬í•­)</label>
                <textarea id="workout-note" placeholder="ìš´ë™ì— ëŒ€í•œ ë©”ëª¨ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
            </div>
            <button class="submit-btn" onclick="saveWorkout()">ìš´ë™ ê¸°ë¡í•˜ê¸°</button>
        </div>
    </div>

    <div id="emotionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ˜Š ê°ì • ê¸°ë¡</h2>
                <button class="close-btn" onclick="closeEmotionModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="emotion-mood">ì˜¤ëŠ˜ì˜ ê¸°ë¶„</label>
                <select id="emotion-mood" required>
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ë§¤ìš° ì¢‹ìŒ">ğŸ˜„ ë§¤ìš° ì¢‹ìŒ</option>
                    <option value="ì¢‹ìŒ">ğŸ˜Š ì¢‹ìŒ</option>
                    <option value="ë³´í†µ">ğŸ˜ ë³´í†µ</option>
                    <option value="ë‚˜ì¨">ğŸ˜ ë‚˜ì¨</option>
                    <option value="ë§¤ìš° ë‚˜ì¨">ğŸ˜¢ ë§¤ìš° ë‚˜ì¨</option>
                    <option value="ìŠ¤íŠ¸ë ˆìŠ¤">ğŸ˜¤ ìŠ¤íŠ¸ë ˆìŠ¤</option>
                    <option value="í”¼ê³¤í•¨">ğŸ˜´ í”¼ê³¤í•¨</option>
                    <option value="í™œê¸°ì°¸">ğŸ¤— í™œê¸°ì°¸</option>
                    <option value="ìš°ìš¸í•¨">ğŸ˜” ìš°ìš¸í•¨</option>
                    <option value="ë¶ˆì•ˆí•¨">ğŸ˜° ë¶ˆì•ˆí•¨</option>
                </select>
            </div>
            <div class="form-group">
                <label for="emotion-energy">ì—ë„ˆì§€ ë ˆë²¨ (1-10)</label>
                <input type="range" id="emotion-energy" min="1" max="10" value="5" oninput="updateEnergyValue(this.value)">
                <div style="text-align: center; margin-top: 5px;">
                    <span id="energy-value">5</span>/10
                </div>
            </div>
            <div class="form-group">
                <label for="emotion-note">ê°ì • ì¼ê¸° (ì„ íƒì‚¬í•­)</label>
                <textarea id="emotion-note" placeholder="ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì´ë‚˜ ìƒê°ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”... 
ì˜ˆ: ì˜¤ëŠ˜ì€ ìš´ë™ì„ ì—´ì‹¬íˆ í•´ì„œ ê¸°ë¶„ì´ ì¢‹ë‹¤. ë‚´ì¼ë„ ê³„ì† í™”ì´íŒ…!"></textarea>
            </div>
            <button class="submit-btn" onclick="saveEmotion()">ê°ì • ê¸°ë¡í•˜ê¸°</button>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">âš™ï¸ í”„ë¡œí•„ ì„¤ì •</h2>
                <button class="close-btn" onclick="closeProfileModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="user-nickname">ë‹‰ë„¤ì„</label>
                <input type="text" id="user-nickname" placeholder="ì‚¬ìš©í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>
            
            <div class="form-group">
                <label for="user-email">ì´ë©”ì¼</label>
                <input type="email" id="user-email" placeholder="ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="user-height">í‚¤ (cm)</label>
                    <input type="number" id="user-height" placeholder="ì˜ˆ: 170" min="100" max="250" step="0.1">
                </div>
                <div class="form-group">
                    <label for="user-age">ë‚˜ì´</label>
                    <input type="number" id="user-age" placeholder="ì˜ˆ: 25" min="15" max="100">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="current-weight-input">í˜„ì¬ ì²´ì¤‘ (kg)</label>
                    <input type="number" id="current-weight-input" placeholder="ì˜ˆ: 70" min="30" max="200" step="0.1">
                </div>
                <div class="form-group">
                    <label for="weight-goal">ëª©í‘œ ì²´ì¤‘ (kg)</label>
                    <input type="number" id="weight-goal" placeholder="ì˜ˆ: 65" min="30" max="200" step="0.1" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="target-date">ëª©í‘œ ë‹¬ì„± ë‚ ì§œ</label>
                    <input type="date" id="target-date">
                </div>
                <div class="form-group">
                    <label for="activity-level">í™œë™ ìˆ˜ì¤€</label>
                    <select id="activity-level">
                        <option value="ë‚®ìŒ">ë‚®ìŒ (ì‚¬ë¬´ì§, ìš´ë™ ê±°ì˜ ì•ˆí•¨)</option>
                        <option value="ë³´í†µ" selected>ë³´í†µ (ê°€ë²¼ìš´ ìš´ë™ ì£¼ 1-3íšŒ)</option>
                        <option value="ë†’ìŒ">ë†’ìŒ (ê·œì¹™ì  ìš´ë™ ì£¼ 3-5íšŒ)</option>
                        <option value="ë§¤ìš°ë†’ìŒ">ë§¤ìš° ë†’ìŒ (ë§¤ì¼ ìš´ë™/ìœ¡ì²´ë…¸ë™)</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="emotion-mode">Claude AI ì„±ê²© ëª¨ë“œ</label>
                <select id="emotion-mode" required>
                    <option value="ë‹¤ì •í•¨">ë‹¤ì •í•˜ê²Œ (ì¹œê·¼í•˜ê³  ë”°ëœ»í•¨) ğŸ¤—</option>
                    <option value="ì¸¤ë°ë ˆ">ì¸¤ë°ë ˆ (ê¹Œì¹ í•˜ì§€ë§Œ ì• ì •ìˆê²Œ) ğŸ˜¤</option>
                    <option value="ë¬´ìë¹„">ë¬´ìë¹„ (ì—„ê²©í•˜ê³  ì§ì„¤ì ) ğŸ˜ˆ</option>
                    <option value="ê²©ë ¤">ê²©ë ¤í˜• (í•­ìƒ ì‘ì›í•˜ê³  ë™ê¸°ë¶€ì—¬) ğŸ’ª</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="daily-goal-calories">ì¼ì¼ ëª©í‘œ ì¹¼ë¡œë¦¬</label>
                <input type="number" id="daily-goal-calories" placeholder="ì˜ˆ: 2000" min="1000" max="5000">
                <small style="color: #666; font-size: 0.8rem;">ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤</small>
            </div>
            
            <button class="submit-btn" onclick="saveProfile()">í”„ë¡œí•„ ì €ì¥í•˜ê¸°</button>
        </div>
    </div>

    <div id="weightModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">âš–ï¸ ì²´ì¤‘ ê¸°ë¡</h2>
                <button class="close-btn" onclick="closeWeightModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="weight-input">ì˜¤ëŠ˜ì˜ ì²´ì¤‘ (kg)</label>
                <input type="number" id="weight-input" placeholder="ì˜ˆ: 69.5" min="30" max="200" step="0.1" required>
            </div>
            <div class="form-group">
                <label for="body-fat">ì²´ì§€ë°©ë¥  (%, ì„ íƒì‚¬í•­)</label>
                <input type="number" id="body-fat" placeholder="ì˜ˆ: 15.5" min="3" max="50" step="0.1">
            </div>
            <div class="form-group">
                <label for="weight-note">ë©”ëª¨ (ì„ íƒì‚¬í•­)</label>
                <textarea id="weight-note" placeholder="ì²´ì¤‘ ë³€í™”ì— ëŒ€í•œ ë©”ëª¨ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
            </div>
            <button class="submit-btn" onclick="saveWeight()">ì²´ì¤‘ ê¸°ë¡í•˜ê¸°</button>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        let currentData = {};
        let currentTheme = localStorage.getItem('theme') || 'light';

        document.addEventListener('DOMContentLoaded', function() {
            if (currentTheme === 'dark') {
                document.body.classList.add('dark');
            }
        });

        function toggleTheme() {
            document.body.classList.toggle('dark');
            currentTheme = document.body.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
        }

        function updateEnergyValue(value) {
            document.getElementById('energy-value').textContent = value;
        }

        function handleEnterKey(event) {
            if (event.key === 'Enter') {
                askClaude();
            }
        }

        window.addEventListener('load', function() {
            console.log('ğŸš€ Dashboard loading...');
            
            // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
            window.currentUserId = 1;
            
            // ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰
            Promise.resolve()
                .then(() => {
                    console.log('1. ê¸°ë³¸ ì‚¬ìš©ì ìƒì„± ì‹œì‘...');
                    return createDefaultUser();
                })
                .then((userId) => {
                    if (userId) {
                        window.currentUserId = userId;
                        console.log(`âœ… ì‚¬ìš©ì ID ì„¤ì •: ${userId}`);
                    }
                    console.log('2. ì‚¬ìš©ì í”„ë¡œí•„ ë¡œë“œ ì‹œì‘...');
                    return loadUserProfile();
                })
                .then(() => {
                    console.log('3. ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë“œ ì‹œì‘...');
                    return loadDashboardStats();
                })
                .then(() => {
                    console.log('4. ì˜¤ëŠ˜ ë°ì´í„° ë¡œë“œ ì‹œì‘...');
                    return loadTodayData();
                })
                .then(() => {
                    console.log('5. Claude ì‘ë‹µ ë¡œë“œ ì‹œì‘...');
                    return loadClaudeResponse();
                })
                .then(() => {
                    console.log('âœ… ëª¨ë“  ì´ˆê¸°í™” ì™„ë£Œ!');
                })
                .catch(error => {
                    console.error('âŒ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
                });
        });

        async function createDefaultUser() {
            try {
                console.log('ğŸ” ê¸°ë³¸ ì‚¬ìš©ì í™•ì¸ ì¤‘...');
                
                // ë¨¼ì € ê¸°ì¡´ ì‚¬ìš©ì í™•ì¸
                const checkResponse = await fetch('/api/user-check/list');
                if (checkResponse.ok) {
                    const result = await checkResponse.json();
                    console.log('ğŸ‘¥ ê¸°ì¡´ ì‚¬ìš©ì ëª©ë¡:', result);
                    
                    if (result.userCount > 0) {
                        console.log('âœ… ê¸°ì¡´ ì‚¬ìš©ì ì¡´ì¬í•¨, ì²« ë²ˆì§¸ ì‚¬ìš©ì ì‚¬ìš©');
                        const firstUser = result.users[0];
                        window.currentUserId = firstUser.id;
                        console.log(`ğŸ¯ ì‚¬ìš©ì ID ì„¤ì •: ${firstUser.id} (${firstUser.nickname})`);
                        return firstUser.id;
                    }
                }
                
                console.log('ğŸ‘¤ ê¸°ë³¸ ì‚¬ìš©ì ìƒì„± ì‹œë„...');
                const response = await fetch('/api/user-check/create-default', {
                    method: 'POST'
                });
                const result = await response.json();
                console.log('ğŸ¯ ê¸°ë³¸ ì‚¬ìš©ì ìƒì„± ê²°ê³¼:', result);
                
                if (result.user) {
                    console.log('âœ… ê¸°ë³¸ ì‚¬ìš©ì ìƒì„± ì„±ê³µ:', result.user);
                    showToast('ê¸°ë³¸ ì‚¬ìš©ìê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    window.currentUserId = result.user.id;
                    return result.user.id;
                } else {
                    console.log('âš ï¸ ê¸°ë³¸ ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨');
                    window.currentUserId = 1;
                    return 1;
                }
            } catch (error) {
                console.error('âŒ ê¸°ë³¸ ì‚¬ìš©ì ìƒì„± ì˜¤ë¥˜:', error);
                showToast('ê¸°ë³¸ ì‚¬ìš©ì ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                window.currentUserId = 1;
                return 1;
            }
        }

        async function loadUserProfile() {
            try {
                const response = await fetch('/api/user-check/get/1');
                if (response.ok) {
                    const data = await response.json();
                    console.log('User profile loaded:', data);
                    
                    const profile = data.user || data;
                    const nicknameEl = document.getElementById('user-nickname-display');
                    const goalEl = document.getElementById('goal-message');
                    const profileNameEl = document.getElementById('profile-name');
                    const profileHeightEl = document.getElementById('profile-height');
                    const profileAgeEl = document.getElementById('profile-age');
                    const profileAvatarEl = document.getElementById('profile-avatar');
                    
                    if (nicknameEl && profile.nickname) {
                        nicknameEl.textContent = `${profile.nickname}ë‹˜, ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹`;
                        if (profileNameEl) profileNameEl.textContent = profile.nickname;
                    }
                    
                    if (goalEl && profile.weightGoal) {
                        goalEl.textContent = `ëª©í‘œ ì²´ì¤‘ ${profile.weightGoal}kgì„ í–¥í•´ í•¨ê»˜ ë‹¬ë ¤ë´ìš”!`;
                    }

                    if (profile.height && profileHeightEl) {
                        profileHeightEl.textContent = profile.height + 'cm';
                    }

                    if (profile.age && profileAgeEl) {
                        profileAgeEl.textContent = profile.age + 'ì„¸';
                    }

                    if (profileAvatarEl) {
                        const avatars = ['ğŸ‘¨', 'ğŸ‘©', 'ğŸ§‘', 'ğŸ‘¤', 'ğŸ˜Š', 'ğŸ¤—', 'ğŸ’ª'];
                        const randomAvatar = avatars[Math.floor(Math.random() * avatars.length)];
                        profileAvatarEl.textContent = randomAvatar;
                    }

                    updateHealthMetrics(profile);
                } else {
                    console.log('User not found, using default display');
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
            }
        }

        function updateHealthMetrics(profile) {
            const currentWeight = profile.currentWeight || 70;
            const goalWeight = profile.weightGoal || 65;
            const height = profile.height || 170;
            
            document.getElementById('current-weight').textContent = currentWeight + 'kg';
            document.getElementById('goal-weight').textContent = goalWeight + 'kg';
            
            const weightDiff = currentWeight - goalWeight;
            const weightDiffEl = document.getElementById('weight-diff');
            if (weightDiff > 0) {
                weightDiffEl.textContent = '-' + weightDiff.toFixed(1) + 'kg';
                weightDiffEl.style.color = '#dc3545';
            } else if (weightDiff < 0) {
                weightDiffEl.textContent = '+' + Math.abs(weightDiff).toFixed(1) + 'kg';
                weightDiffEl.style.color = '#28a745';
            } else {
                weightDiffEl.textContent = 'ëª©í‘œë‹¬ì„±!';
                weightDiffEl.style.color = '#28a745';
            }

            const bmi = (currentWeight / ((height/100) ** 2)).toFixed(1);
            document.getElementById('bmi-value').textContent = bmi;
            
            let bmiStatus = '';
            let bmiColor = '';
            if (bmi < 18.5) {
                bmiStatus = 'ì €ì²´ì¤‘';
                bmiColor = '#ffc107';
            } else if (bmi < 25) {
                bmiStatus = 'ì •ìƒ ì²´ì¤‘';
                bmiColor = '#28a745';
            } else if (bmi < 30) {
                bmiStatus = 'ê³¼ì²´ì¤‘';
                bmiColor = '#fd7e14';
            } else {
                bmiStatus = 'ë¹„ë§Œ';
                bmiColor = '#dc3545';
            }
            
            const bmiStatusEl = document.getElementById('bmi-status');
            bmiStatusEl.textContent = bmiStatus;
            bmiStatusEl.style.color = 'rgba(255,255,255,0.9)';

            if (profile.targetDate) {
                const targetDate = new Date(profile.targetDate);
                const today = new Date();
                const daysLeft = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));
                
                if (daysLeft > 0) {
                    document.getElementById('days-left').textContent = daysLeft + 'ì¼';
                } else if (daysLeft === 0) {
                    document.getElementById('days-left').textContent = 'D-Day';
                } else {
                    document.getElementById('days-left').textContent = 'ê¸°ê°„ë§Œë£Œ';
                }
            }
        }

        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/debug/all-data');
                if (response.ok) {
                    const data = await response.json();
                    console.log('ğŸ“Š ì „ì²´ ë°ì´í„° ë¡œë“œë¨:', data);
                    
                    const today = new Date().toISOString().split('T')[0];
                    const mealCount = data.meals ? data.meals.filter(meal => 
                        meal.date === today || (meal.date && meal.date.startsWith(today))
                    ).length : 0;
                    const workoutCount = data.workouts ? data.workouts.filter(workout => 
                        workout.date === today || (workout.date && workout.date.startsWith(today))
                    ).length : 0;
                    const emotionCount = data.emotions ? data.emotions.filter(emotion => 
                        emotion.date === today || (emotion.date && emotion.date.startsWith(today))
                    ).length : 0;
                    
                    console.log('ğŸ“ˆ ì˜¤ëŠ˜ í†µê³„:', { mealCount, workoutCount, emotionCount });
                    
                    animateValue('meal-count', 0, mealCount, 1000);
                    animateValue('workout-count', 0, workoutCount, 1200);
                    animateValue('emotion-count', 0, emotionCount, 1400);
                    
                    const achievement = Math.min(100, Math.round((mealCount * 30) + (workoutCount * 40) + (emotionCount * 30)));
                    setTimeout(() => {
                        document.getElementById('goal-achievement').textContent = achievement + '%';
                    }, 1600);
                    
                    const progressFill = document.getElementById('progress-fill');
                    const progressText = document.getElementById('progress-text');
                    
                    setTimeout(() => {
                        progressFill.style.width = achievement + '%';
                    }, 500);
                    
                    if (achievement >= 100) {
                        progressText.textContent = 'ğŸ‰ ì˜¤ëŠ˜ ëª©í‘œë¥¼ ì™„ë²½í•˜ê²Œ ë‹¬ì„±í–ˆì–´ìš”!';
                    } else if (achievement >= 70) {
                        progressText.textContent = 'ğŸ’ª ëª©í‘œê¹Œì§€ ì¡°ê¸ˆë§Œ ë”! í™”ì´íŒ…!';
                    } else if (achievement >= 40) {
                        progressText.textContent = 'ğŸ”¥ ì¢‹ì€ í˜ì´ìŠ¤ì˜ˆìš”! ê³„ì† í•´ë´ìš”!';
                    } else {
                        progressText.textContent = 'ğŸŒ± ì˜¤ëŠ˜ë„ ê±´ê°•í•œ í•˜ë£¨ë¥¼ ë§Œë“¤ì–´ê°€ìš”!';
                    }

                    const totalCalories = data.meals ? data.meals
                        .filter(meal => meal.date === today || (meal.date && meal.date.startsWith(today)))
                        .reduce((sum, meal) => sum + (meal.caloriesEstimate || 0), 0) : 0;
                    const totalBurned = data.workouts ? data.workouts
                        .filter(workout => workout.date === today || (workout.date && workout.date.startsWith(today)))
                        .reduce((sum, workout) => sum + (workout.caloriesBurned || 0), 0) : 0;
                    
                    animateValue('total-calories', 0, totalCalories, 1000);
                    animateValue('burned-calories', 0, totalBurned, 1200);
                    setTimeout(() => {
                        document.getElementById('net-calories').textContent = totalCalories - totalBurned;
                    }, 1400);

                    const waterIntake = Math.random() * 2 + 1;
                    document.getElementById('water-intake').textContent = waterIntake.toFixed(1) + 'L';
                } else {
                    console.log('âŒ í†µê³„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', response.status);
                    showToast('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('âŒ ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
                showToast('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        function animateValue(id, start, end, duration) {
            const element = document.getElementById(id);
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.round(current);
            }, 16);
        }

        async function loadTodayData() {
            try {
                const response = await fetch('/api/debug/all-data');
                if (response.ok) {
                    const data = await response.json();
                    console.log('ğŸ“… ì˜¤ëŠ˜ ë°ì´í„° ë¡œë“œ:', data);
                    
                    const today = new Date().toISOString().split('T')[0];
                    const todayMeals = data.meals ? data.meals.filter(meal => 
                        meal.date === today || (meal.date && meal.date.startsWith(today))
                    ) : [];
                    const todayWorkouts = data.workouts ? data.workouts.filter(workout => 
                        workout.date === today || (workout.date && workout.date.startsWith(today))
                    ) : [];
                    const todayEmotions = data.emotions ? data.emotions.filter(emotion => 
                        emotion.date === today || (emotion.date && emotion.date.startsWith(today))
                    ) : [];
                    
                    console.log('ğŸ” í•„í„°ëœ ì˜¤ëŠ˜ ë°ì´í„°:', {
                        meals: todayMeals.length,
                        workouts: todayWorkouts.length,
                        emotions: todayEmotions.length
                    });
                    
                    displayMeals(todayMeals);
                    displayWorkouts(todayWorkouts);
                    displayEmotions(todayEmotions);
                    
                    currentData = {
                        meals: todayMeals,
                        workouts: todayWorkouts,
                        emotions: todayEmotions
                    };
                } else {
                    console.log('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨, ë¹ˆ ìƒíƒœ í‘œì‹œ');
                    displayEmptyStates();
                }
            } catch (error) {
                console.error('âŒ ì˜¤ëŠ˜ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                displayEmptyStates();
                showToast('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        function displayEmptyStates() {
            document.getElementById('meal-list').innerHTML = `
                <div class="empty-state">
                    <div class="emoji">ğŸ½ï¸</div>
                    <p>ì•„ì§ ê¸°ë¡ëœ ì‹ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    <button class="add-btn" onclick="openMealModal()">ì²« ì‹ë‹¨ ê¸°ë¡í•˜ê¸°</button>
                </div>
            `;
            document.getElementById('workout-list').innerHTML = `
                <div class="empty-state">
                    <div class="emoji">ğŸƒ</div>
                    <p>ì•„ì§ ê¸°ë¡ëœ ìš´ë™ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    <button class="add-btn" onclick="openWorkoutModal()">ì²« ìš´ë™ ê¸°ë¡í•˜ê¸°</button>
                </div>
            `;
            document.getElementById('emotion-list').innerHTML = `
                <div class="empty-state">
                    <div class="emoji">ğŸ˜Š</div>
                    <p>ì•„ì§ ê¸°ë¡ëœ ê°ì •ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    <button class="add-btn" onclick="openEmotionModal()">ì²« ê°ì • ê¸°ë¡í•˜ê¸°</button>
                </div>
            `;
        }

        function displayMeals(meals) {
            const mealList = document.getElementById('meal-list');
            
            if (meals.length === 0) {
                mealList.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">ğŸ½ï¸</div>
                        <p>ì•„ì§ ê¸°ë¡ëœ ì‹ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        <button class="add-btn" onclick="openMealModal()">ì²« ì‹ë‹¨ ê¸°ë¡í•˜ê¸°</button>
                    </div>
                `;
                return;
            }
            
            mealList.innerHTML = meals.map((meal, index) => {
                const mealTime = getMealTimeFromDescription(meal.description);
                const mealIcon = getMealIcon(mealTime);
                return `
                    <div class="data-card" style="animation-delay: ${index * 0.1}s">
                        <h4>${mealIcon} ${meal.description || 'ì‹ë‹¨'}</h4>
                        <p>ğŸ”¥ ${meal.caloriesEstimate || 0} kcal | â° ${getTimeAgo(meal.createdAt)}</p>
                        <div class="data-actions">
                            <button class="edit-btn" onclick="editMeal(${meal.id})">ìˆ˜ì •</button>
                            <button class="delete-btn" onclick="deleteMeal(${meal.id})">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayWorkouts(workouts) {
            const workoutList = document.getElementById('workout-list');
            
            if (workouts.length === 0) {
                workoutList.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">ğŸƒ</div>
                        <p>ì•„ì§ ê¸°ë¡ëœ ìš´ë™ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        <button class="add-btn" onclick="openWorkoutModal()">ì²« ìš´ë™ ê¸°ë¡í•˜ê¸°</button>
                    </div>
                `;
                return;
            }
            
            workoutList.innerHTML = workouts.map((workout, index) => {
                const workoutIcon = getWorkoutIcon(workout.type);
                const intensityColor = getIntensityColor(workout.intensity);
                return `
                    <div class="data-card" style="animation-delay: ${index * 0.1}s">
                        <h4>${workoutIcon} ${workout.type || 'ìš´ë™'}</h4>
                        <p>â±ï¸ ${workout.duration || 0}ë¶„ | ğŸ”¥ ${workout.caloriesBurned || 0}kcal | <span style="color: ${intensityColor}">â—</span> ${workout.intensity || 'ë³´í†µ'}</p>
                        <div class="data-actions">
                            <button class="edit-btn" onclick="editWorkout(${workout.id})">ìˆ˜ì •</button>
                            <button class="delete-btn" onclick="deleteWorkout(${workout.id})">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayEmotions(emotions) {
            const emotionList = document.getElementById('emotion-list');
            
            if (emotions.length === 0) {
                emotionList.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">ğŸ˜Š</div>
                        <p>ì•„ì§ ê¸°ë¡ëœ ê°ì •ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        <button class="add-btn" onclick="openEmotionModal()">ì²« ê°ì • ê¸°ë¡í•˜ê¸°</button>
                    </div>
                `;
                return;
            }
            
            emotionList.innerHTML = emotions.map((emotion, index) => {
                const moodEmoji = getMoodEmoji(emotion.mood);
                return `
                    <div class="data-card" style="animation-delay: ${index * 0.1}s">
                        <h4>${moodEmoji} ${emotion.mood || 'ê¸°ë¶„'}</h4>
                        <p>${emotion.note ? (emotion.note.length > 50 ? emotion.note.substring(0, 50) + '...' : emotion.note) : 'ë©”ëª¨ ì—†ìŒ'}</p>
                        <div class="data-actions">
                            <button class="edit-btn" onclick="editEmotion(${emotion.id})">ìˆ˜ì •</button>
                            <button class="delete-btn" onclick="deleteEmotion(${emotion.id})">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getMealTimeFromDescription(description) {
            if (!description) return 'ì‹ì‚¬';
            if (description.includes('ì•„ì¹¨')) return 'ì•„ì¹¨';
            if (description.includes('ì ì‹¬')) return 'ì ì‹¬';
            if (description.includes('ì €ë…')) return 'ì €ë…';
            if (description.includes('ê°„ì‹')) return 'ê°„ì‹';
            return 'ì‹ì‚¬';
        }

        function getMealIcon(mealTime) {
            const icons = {
                'ì•„ì¹¨': 'ğŸŒ…',
                'ì ì‹¬': 'â˜€ï¸',
                'ì €ë…': 'ğŸŒ™',
                'ê°„ì‹': 'ğŸª',
                'ì‹ì‚¬': 'ğŸ½ï¸'
            };
            return icons[mealTime] || 'ğŸ½ï¸';
        }

        function getWorkoutIcon(type) {
            const icons = {
                'ê±·ê¸°': 'ğŸš¶',
                'ì¡°ê¹…': 'ğŸƒ',
                'ë‹¬ë¦¬ê¸°': 'ğŸƒâ€â™‚ï¸',
                'ìì „ê±°': 'ğŸš´',
                'ìˆ˜ì˜': 'ğŸŠ',
                'í—¬ìŠ¤': 'ğŸ’ª',
                'ìš”ê°€': 'ğŸ§˜',
                'í•„ë¼í…ŒìŠ¤': 'ğŸ¤¸',
                'ë“±ì‚°': 'ğŸ¥¾',
                'ì¶•êµ¬': 'âš½',
                'ë†êµ¬': 'ğŸ€',
                'í…Œë‹ˆìŠ¤': 'ğŸ¾',
                'ë°°ë“œë¯¼í„´': 'ğŸ¸'
            };
            return icons[type] || 'ğŸƒ';
        }

        function getIntensityColor(intensity) {
            const colors = {
                'ë‚®ìŒ': '#28a745',
                'ë³´í†µ': '#ffc107',
                'ë†’ìŒ': '#dc3545'
            };
            return colors[intensity] || '#6c757d';
        }

        function getMoodEmoji(mood) {
            const emojis = {
                'ë§¤ìš° ì¢‹ìŒ': 'ğŸ˜„',
                'ì¢‹ìŒ': 'ğŸ˜Š',
                'ë³´í†µ': 'ğŸ˜',
                'ë‚˜ì¨': 'ğŸ˜',
                'ë§¤ìš° ë‚˜ì¨': 'ğŸ˜¢',
                'ìŠ¤íŠ¸ë ˆìŠ¤': 'ğŸ˜¤',
                'í”¼ê³¤í•¨': 'ğŸ˜´',
                'í™œê¸°ì°¸': 'ğŸ¤—',
                'ìš°ìš¸í•¨': 'ğŸ˜”',
                'ë¶ˆì•ˆí•¨': 'ğŸ˜°'
            };
            return emojis[mood] || 'ğŸ˜Š';
        }

        function getTimeAgo(timestamp) {
            if (!timestamp) return '';
            const now = new Date();
            const time = new Date(timestamp);
            const diff = Math.floor((now - time) / 1000 / 60);
            
            if (diff < 1) return 'ë°©ê¸ˆ ì „';
            if (diff < 60) return `${diff}ë¶„ ì „`;
            if (diff < 1440) return `${Math.floor(diff / 60)}ì‹œê°„ ì „`;
            return `${Math.floor(diff / 1440)}ì¼ ì „`;
        }

        async function loadClaudeResponse() {
            try {
                const responses = [
                    "ì˜¤ëŠ˜ë„ ê±´ê°•í•œ í•˜ë£¨ë¥¼ ìœ„í•´ í•¨ê»˜í•´ìš”! ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ì„±ê³µì˜ ì—´ì‡ ì…ë‹ˆë‹¤. ğŸ’ª",
                    "ì‘ì€ ë³€í™”ê°€ í° ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤. ì˜¤ëŠ˜ í•œ ê±¸ìŒì”© ëª©í‘œì— ë‹¤ê°€ê°€ê³  ìˆì–´ìš”! ğŸŒŸ",
                    "ê±´ê°•í•œ ì‹ë‹¨ê³¼ ê¾¸ì¤€í•œ ìš´ë™ìœ¼ë¡œ ë” ë‚˜ì€ ë‚´ì¼ì„ ë§Œë“¤ì–´ê°€ì„¸ìš”! ğŸ",
                    "ë‹¹ì‹ ì˜ ë…¸ë ¥ì„ ì‘ì›í•©ë‹ˆë‹¤! ë§¤ì¼ ì¡°ê¸ˆì”© ì„±ì¥í•˜ëŠ” ëª¨ìŠµì´ ì•„ë¦„ë‹¤ì›Œìš”. ğŸŒ±",
                    "ëª©í‘œë¥¼ í–¥í•œ ì—¬ì •ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ ì§€ì†ì„±ì…ë‹ˆë‹¤. í•¨ê»˜ í•´ë´ìš”! ğŸš€"
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                document.getElementById('claude-response').innerHTML = randomResponse;
            } catch (error) {
                console.error('Error loading Claude response:', error);
                document.getElementById('claude-response').innerHTML = 'ê±´ê°•í•œ í•˜ë£¨ ë³´ë‚´ì„¸ìš”! ğŸ’ª';
            }
        }

        function openMealModal() {
            const modal = document.getElementById('mealModal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeMealModal() {
            const modal = document.getElementById('mealModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                document.getElementById('meal-description').value = '';
                document.getElementById('meal-calories').value = '';
                document.getElementById('meal-time').value = 'ì•„ì¹¨';
            }
        }

        function openWorkoutModal() {
            const modal = document.getElementById('workoutModal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeWorkoutModal() {
            const modal = document.getElementById('workoutModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                document.getElementById('workout-type').value = '';
                document.getElementById('workout-duration').value = '';
                document.getElementById('workout-intensity').value = 'ë³´í†µ';
                document.getElementById('workout-note').value = '';
            }
        }

        function openEmotionModal() {
            const modal = document.getElementById('emotionModal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeEmotionModal() {
            const modal = document.getElementById('emotionModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                document.getElementById('emotion-mood').value = '';
                document.getElementById('emotion-energy').value = '5';
                document.getElementById('energy-value').textContent = '5';
                document.getElementById('emotion-note').value = '';
            }
        }

        function openProfileModal() {
            loadCurrentProfile();
            const modal = document.getElementById('profileModal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }

        function openWeightModal() {
            const modal = document.getElementById('weightModal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeWeightModal() {
            const modal = document.getElementById('weightModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                document.getElementById('weight-input').value = '';
                document.getElementById('body-fat').value = '';
                document.getElementById('weight-note').value = '';
            }
        }

        window.onclick = function(event) {
            const modals = ['mealModal', 'workoutModal', 'emotionModal', 'profileModal', 'weightModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal && event.target === modal) {
                    modal.classList.remove('show');
                    setTimeout(() => {
                        modal.style.display = 'none';
                    }, 300);
                }
            });
        };

        async function loadCurrentProfile() {
            try {
                const response = await fetch('/api/user-check/get/1');
                if (response.ok) {
                    const data = await response.json();
                    const profile = data.user || data;
                    
                    if (profile.nickname) document.getElementById('user-nickname').value = profile.nickname;
                    if (profile.email) document.getElementById('user-email').value = profile.email;
                    if (profile.height) document.getElementById('user-height').value = profile.height;
                    if (profile.age) document.getElementById('user-age').value = profile.age;
                    if (profile.currentWeight) document.getElementById('current-weight-input').value = profile.currentWeight;
                    if (profile.weightGoal) document.getElementById('weight-goal').value = profile.weightGoal;
                    if (profile.targetDate) document.getElementById('target-date').value = profile.targetDate;
                    if (profile.activityLevel) document.getElementById('activity-level').value = profile.activityLevel;
                    if (profile.emotionMode) document.getElementById('emotion-mode').value = profile.emotionMode;
                    if (profile.dailyGoalCalories) document.getElementById('daily-goal-calories').value = profile.dailyGoalCalories;
                }
            } catch (error) {
                console.error('Error loading current profile:', error);
            }
        }

        async function saveMeal() {
            const description = document.getElementById('meal-description').value.trim();
            const calories = parseInt(document.getElementById('meal-calories').value) || 0;
            const mealTime = document.getElementById('meal-time').value;
            
            if (!description) {
                showToast('ì‹ë‹¨ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }
            
            if (calories <= 0) {
                showToast('ì¹¼ë¡œë¦¬ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            const userId = window.currentUserId || 1;
            console.log('ğŸ’¾ ì‹ë‹¨ ì €ì¥ ì‹œë„:', {
                userId: userId,
                description: `${mealTime}: ${description}`,
                caloriesEstimate: calories
            });

            try {
                const response = await fetch('/api/debug/test-meal', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        userId: userId,
                        description: `${mealTime}: ${description}`,
                        caloriesEstimate: calories
                    })
                });

                console.log('ğŸ“¡ ì‘ë‹µ ìƒíƒœ:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('ğŸ“¥ ì„œë²„ ì‘ë‹µ:', result);
                
                if (result.success || result.savedMeal) {
                    showToast('ğŸ½ï¸ ì‹ë‹¨ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    closeMealModal();
                    setTimeout(() => {
                        refreshDashboard();
                    }, 1000);
                } else {
                    showToast('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }
            } catch (error) {
                console.error('âŒ ì‹ë‹¨ ì €ì¥ ì˜¤ë¥˜:', error);
                showToast(`API ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        async function saveWorkout() {
            const type = document.getElementById('workout-type').value;
            const duration = parseInt(document.getElementById('workout-duration').value) || 0;
            const intensity = document.getElementById('workout-intensity').value;
            const note = document.getElementById('workout-note').value.trim();
            
            if (!type) {
                showToast('ìš´ë™ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                return;
            }
            
            if (duration <= 0) {
                showToast('ìš´ë™ ì‹œê°„ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            const calorieRates = {
                'ê±·ê¸°': { 'ë‚®ìŒ': 3, 'ë³´í†µ': 4, 'ë†’ìŒ': 5 },
                'ì¡°ê¹…': { 'ë‚®ìŒ': 6, 'ë³´í†µ': 8, 'ë†’ìŒ': 10 },
                'ë‹¬ë¦¬ê¸°': { 'ë‚®ìŒ': 8, 'ë³´í†µ': 12, 'ë†’ìŒ': 15 },
                'ìì „ê±°': { 'ë‚®ìŒ': 5, 'ë³´í†µ': 7, 'ë†’ìŒ': 10 },
                'ìˆ˜ì˜': { 'ë‚®ìŒ': 7, 'ë³´í†µ': 10, 'ë†’ìŒ': 13 },
                'í—¬ìŠ¤': { 'ë‚®ìŒ': 4, 'ë³´í†µ': 6, 'ë†’ìŒ': 8 },
                'ìš”ê°€': { 'ë‚®ìŒ': 2, 'ë³´í†µ': 3, 'ë†’ìŒ': 4 },
                'í•„ë¼í…ŒìŠ¤': { 'ë‚®ìŒ': 3, 'ë³´í†µ': 4, 'ë†’ìŒ': 5 },
                'ë“±ì‚°': { 'ë‚®ìŒ': 6, 'ë³´í†µ': 8, 'ë†’ìŒ': 12 },
                'ì¶•êµ¬': { 'ë‚®ìŒ': 7, 'ë³´í†µ': 10, 'ë†’ìŒ': 13 },
                'ë†êµ¬': { 'ë‚®ìŒ': 6, 'ë³´í†µ': 9, 'ë†’ìŒ': 12 },
                'í…Œë‹ˆìŠ¤': { 'ë‚®ìŒ': 5, 'ë³´í†µ': 7, 'ë†’ìŒ': 10 },
                'ë°°ë“œë¯¼í„´': { 'ë‚®ìŒ': 4, 'ë³´í†µ': 6, 'ë†’ìŒ': 8 }
            };

            const rate = calorieRates[type] ? calorieRates[type][intensity] : 5;
            const caloriesBurned = Math.round(rate * duration);
            const userId = window.currentUserId || 1;

            console.log('ğŸ’¾ ìš´ë™ ì €ì¥ ì‹œë„:', {
                userId: userId,
                type: type,
                duration: duration,
                intensity: intensity,
                caloriesBurned: caloriesBurned
            });

            try {
                const response = await fetch('/api/debug/test-workout', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        userId: userId,
                        type: type,
                        duration: duration,
                        intensity: intensity,
                        caloriesBurned: caloriesBurned,
                        note: note
                    })
                });

                console.log('ğŸ“¡ ìš´ë™ ì‘ë‹µ ìƒíƒœ:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.log('âŒ ì‘ë‹µ ì—ëŸ¬:', errorText);
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('ğŸ“¥ ìš´ë™ ì„œë²„ ì‘ë‹µ:', result);
                
                if (result.success || result.savedWorkout) {
                    showToast(`ğŸƒ ìš´ë™ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! (${caloriesBurned}kcal ì†Œëª¨)`);
                    closeWorkoutModal();
                    setTimeout(() => {
                        refreshDashboard();
                    }, 1000);
                } else {
                    showToast('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }
            } catch (error) {
                console.error('âŒ ìš´ë™ ì €ì¥ ì˜¤ë¥˜:', error);
                showToast(`ìš´ë™ ì €ì¥ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function saveEmotion() {
            const mood = document.getElementById('emotion-mood').value;
            const energy = document.getElementById('emotion-energy').value;
            const note = document.getElementById('emotion-note').value.trim();
            
            if (!mood) {
                showToast('ê¸°ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            console.log('ğŸ’¾ ê°ì • ì €ì¥ ì‹œë„:', {
                userId: 1,
                mood: mood,
                energyLevel: parseInt(energy),
                note: note
            });

            try {
                // IntegratedSaveControllerì˜ ì‹¤ì œ ê²½ë¡œ ì‚¬ìš©
                const response = await fetch('/api/integrated/emotion', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        userId: 1,
                        mood: mood,
                        energyLevel: parseInt(energy),
                        note: note
                    })
                });

                console.log('ğŸ“¡ ê°ì • ì‘ë‹µ ìƒíƒœ:', response.status);
                
                if (!response.ok) {
                    // 404 ì—ëŸ¬ì¸ ê²½ìš° ë‹¤ë¥¸ ê²½ë¡œ ì‹œë„
                    console.log('âŒ ì²« ë²ˆì§¸ API ì‹¤íŒ¨, ë‹¤ë¥¸ ê²½ë¡œ ì‹œë„...');
                    
                    // SaveDebugControllerì— ê°ì • ì €ì¥ì´ ì—†ìœ¼ë¯€ë¡œ ì„ì‹œë¡œ ë‹¤ë¥¸ ë°©ì‹ ì‹œë„
                    const result = {
                        success: false,
                        error: `API not found (${response.status})`
                    };
                    
                    throw new Error(`HTTP ${response.status}: API ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
                }
                
                const result = await response.json();
                console.log('ğŸ“¥ ê°ì • ì„œë²„ ì‘ë‹µ:', result);
                
                if (result.success || result.emotion) {
                    showToast('ğŸ˜Š ê°ì •ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    closeEmotionModal();
                    setTimeout(() => {
                        refreshDashboard();
                    }, 1000);
                } else {
                    showToast('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }
            } catch (error) {
                console.error('âŒ ê°ì • ì €ì¥ ì˜¤ë¥˜:', error);
                showToast('ê°ì • ì €ì¥ APIê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë°±ì—”ë“œ í™•ì¸ í•„ìš”!', 'error');
            }
        }

        async function saveProfile() {
            const nickname = document.getElementById('user-nickname').value.trim();
            const email = document.getElementById('user-email').value.trim();
            const height = parseFloat(document.getElementById('user-height').value) || 0;
            const age = parseInt(document.getElementById('user-age').value) || 0;
            const currentWeight = parseFloat(document.getElementById('current-weight-input').value) || 0;
            const weightGoal = parseFloat(document.getElementById('weight-goal').value) || 0;
            const targetDate = document.getElementById('target-date').value;
            const activityLevel = document.getElementById('activity-level').value;
            const emotionMode = document.getElementById('emotion-mode').value;
            const dailyGoalCalories = parseInt(document.getElementById('daily-goal-calories').value) || 0;
            
            if (!nickname) {
                showToast('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }
            
            if (!weightGoal) {
                showToast('ëª©í‘œ ì²´ì¤‘ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            try {
                localStorage.setItem('userProfile', JSON.stringify({
                    nickname: nickname,
                    email: email,
                    height: height,
                    age: age,
                    currentWeight: currentWeight,
                    weightGoal: weightGoal,
                    targetDate: targetDate,
                    activityLevel: activityLevel,
                    emotionMode: emotionMode,
                    dailyGoalCalories: dailyGoalCalories > 0 ? dailyGoalCalories : null
                }));

                showToast('âš™ï¸ í”„ë¡œí•„ì´ ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ë°±ì—”ë“œ API ê°œë°œ í•„ìš”)');
                closeProfileModal();
                setTimeout(() => {
                    refreshDashboard();
                }, 1000);
            } catch (error) {
                showToast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                console.error('Error:', error);
            }
        }

        async function saveWeight() {
            const weight = parseFloat(document.getElementById('weight-input').value) || 0;
            const bodyFat = parseFloat(document.getElementById('body-fat').value) || null;
            const note = document.getElementById('weight-note').value.trim();
            
            if (weight <= 0) {
                showToast('ì²´ì¤‘ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            try {
                const updateResponse = await fetch('/api/user-check/update/1', {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        currentWeight: weight
                    })
                });

                if (updateResponse.ok) {
                    showToast('âš–ï¸ ì²´ì¤‘ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    closeWeightModal();
                    setTimeout(() => {
                        refreshDashboard();
                    }, 1000);
                } else {
                    showToast('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                showToast('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                console.error('Error:', error);
            }
        }

        async function askClaude() {
            const input = document.getElementById('ai-question-input');
            const question = input.value.trim();
            
            if (!question) {
                showToast('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            addChatMessage(question, true);
            input.value = '';
            showTypingIndicator();

            try {
                const response = await fetch('/api/chat/ask', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        question: question,
                        userId: 1
                    })
                });

                const result = await response.json();
                hideTypingIndicator();

                if (result.success) {
                    addChatMessage(result.response, false);
                } else {
                    addChatMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', false);
                }
            } catch (error) {
                hideTypingIndicator();
                addChatMessage('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', false);
                console.error('Error:', error);
            }
        }

        function addChatMessage(message, isUser) {
            const messagesContainer = document.getElementById('ai-chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `ai-message ${isUser ? 'user-message' : ''}`;
            
            messageDiv.innerHTML = `
                <div class="ai-avatar">${isUser ? 'ğŸ‘¤' : 'ğŸ¤–'}</div>
                <div class="ai-text">${message}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('ai-chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'ai-message typing-indicator';
            typingDiv.id = 'typing-indicator';
            
            typingDiv.innerHTML = `
                <div class="ai-avatar">ğŸ¤–</div>
                <div class="ai-text">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function deleteMeal(id) {
            if (!confirm('ì´ ì‹ë‹¨ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`/api/delete/meal/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showToast('ğŸ—‘ï¸ ì‹ë‹¨ ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    refreshDashboard();
                } else {
                    showToast('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.message || result.error), 'error');
                }
            } catch (error) {
                showToast('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                console.error('Error:', error);
            }
        }

        async function deleteWorkout(id) {
            if (!confirm('ì´ ìš´ë™ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`/api/delete/workout/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showToast('ğŸ—‘ï¸ ìš´ë™ ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    refreshDashboard();
                } else {
                    showToast('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.message || result.error), 'error');
                }
            } catch (error) {
                showToast('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                console.error('Error:', error);
            }
        }

        async function deleteEmotion(id) {
            if (!confirm('ì´ ê°ì • ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`/api/delete/emotion/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showToast('ğŸ—‘ï¸ ê°ì • ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    refreshDashboard();
                } else {
                    showToast('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.message || result.error), 'error');
                }
            } catch (error) {
                showToast('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                console.error('Error:', error);
            }
        }

        function editMeal(id) {
            showToast('í¸ì§‘ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'error');
        }

        function editWorkout(id) {
            showToast('í¸ì§‘ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'error');
        }

        function editEmotion(id) {
            showToast('í¸ì§‘ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'error');
        }

        async function deleteAllTodayData() {
            if (!confirm('âš ï¸ ì˜¤ëŠ˜ì˜ ëª¨ë“  ë°ì´í„°(ì‹ë‹¨, ìš´ë™, ê°ì •)ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) return;

            try {
                const response = await fetch('/api/delete/all/today', {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showToast(`ğŸ—‘ï¸ ${result.message}`, 'success');
                    refreshDashboard();
                } else {
                    showToast('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }
            } catch (error) {
                showToast('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                console.error('Error:', error);
            }
        }

        async function refreshDashboard() {
            showToast('ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ìˆìŠµë‹ˆë‹¤...');
            
            try {
                await Promise.all([
                    loadUserProfile(),
                    loadDashboardStats(),
                    loadTodayData(),
                    loadClaudeResponse()
                ]);
                
                showToast('ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ!');
            } catch (error) {
                showToast('ìƒˆë¡œê³ ì¹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                console.error('Error:', error);
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const openModal = document.querySelector('.modal.show');
                if (openModal) {
                    openModal.classList.remove('show');
                    setTimeout(() => {
                        openModal.style.display = 'none';
                    }, 300);
                }
            }
        });

        function showRandomTip() {
            const tips = [
                "ğŸ’¡ ë¬¼ì„ ì¶©ë¶„íˆ ë§ˆì‹œë©´ ì‹ ì§„ëŒ€ì‚¬ê°€ í–¥ìƒë©ë‹ˆë‹¤!",
                "ğŸ í•˜ë£¨ì— ê³¼ì¼ 2-3ê°œ ì •ë„ê°€ ì ë‹¹í•©ë‹ˆë‹¤!",
                "ğŸƒâ€â™‚ï¸ ì¼ì£¼ì¼ì— 150ë¶„ ì´ìƒ ìš´ë™í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•´ë³´ì„¸ìš”!",
                "ğŸ˜´ ì¶©ë¶„í•œ ìˆ˜ë©´ì€ ì²´ì¤‘ ê´€ë¦¬ì— ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤!",
                "ğŸ¥— ë‹¤ì–‘í•œ ìƒ‰ê¹”ì˜ ì±„ì†Œë¥¼ ë“œì„¸ìš”!",
                "ğŸ’ª ê·¼ë ¥ ìš´ë™ë„ ìœ ì‚°ì†Œ ìš´ë™ë§Œí¼ ì¤‘ìš”í•©ë‹ˆë‹¤!",
                "ğŸ§˜â€â™€ï¸ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ë„ ê±´ê°•í•œ ë‹¤ì´ì–´íŠ¸ì˜ í•µì‹¬ì…ë‹ˆë‹¤!"
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            setTimeout(() => {
                showToast(randomTip);
            }, 5000);
        }

        setTimeout(showRandomTip, 10000);
    </script>
</body>
</html>