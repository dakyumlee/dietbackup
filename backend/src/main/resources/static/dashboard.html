<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyDiet - ÎåÄÏãúÎ≥¥Îìú</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        body.dark {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .theme-toggle::before {
            content: '‚òÄÔ∏è';
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        body.dark .theme-toggle::before {
            content: 'üåô';
            transform: translateX(30px);
            background: #1e293b;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        body.dark .header {
            background: rgba(30, 41, 59, 0.95);
            color: #e2e8f0;
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        body.dark .header h1 {
            background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        body.dark .header p {
            color: #94a3b8;
        }

        .user-welcome {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        body.dark .user-welcome {
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
        }

        .user-welcome::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .user-welcome h2 {
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .user-welcome p {
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.8);
            transform: translateY(-2px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .main-dashboard {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        body.dark .stat-card {
            background: #1e293b;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        body.dark .stat-card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            counter-reset: stat-counter 0;
            animation: countUp 2s ease-out;
        }

        body.dark .stat-value {
            color: #e2e8f0;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        body.dark .stat-label {
            color: #94a3b8;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        body.dark .main-content {
            background: #1e293b;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        body.dark .sidebar-card {
            background: #1e293b;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        body.dark .section-header {
            border-bottom-color: #334155;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
        }

        body.dark .section-title {
            color: #e2e8f0;
        }

        .add-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .data-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
            position: relative;
            overflow: hidden;
        }

        body.dark .data-card {
            background: #334155;
            color: #e2e8f0;
        }

        .data-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .data-card:hover::before {
            left: 100%;
        }

        .data-card:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        body.dark .data-card:hover {
            background: #475569;
        }

        .data-card h4 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        body.dark .data-card h4 {
            color: #e2e8f0;
        }

        .data-card p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        body.dark .data-card p {
            color: #94a3b8;
        }

        .data-actions {
            display: flex;
            gap: 10px;
        }

        .edit-btn, .delete-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: #28a745;
            color: white;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .edit-btn:hover, .delete-btn:hover {
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }

        body.dark .empty-state {
            background: #334155;
            border-color: #475569;
            color: #94a3b8;
        }

        .empty-state .emoji {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .empty-state p {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .goal-progress {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        body.dark .goal-progress {
            background: #1e293b;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .goal-progress h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3rem;
        }

        body.dark .goal-progress h3 {
            color: #e2e8f0;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 12px;
            height: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }

        body.dark .progress-bar {
            background: #475569;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.8s ease;
            border-radius: 12px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        .progress-text {
            font-size: 1rem;
            color: #666;
            text-align: center;
            font-weight: 500;
        }

        body.dark .progress-text {
            color: #94a3b8;
        }

        .nutrition-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .nutrition-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        body.dark .nutrition-item {
            background: #334155;
        }

        .nutrition-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .nutrition-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        body.dark .nutrition-value {
            color: #818cf8;
        }

        .nutrition-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        body.dark .nutrition-label {
            color: #94a3b8;
        }

        .bmi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        body.dark .bmi-card {
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
        }

        .bmi-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255,255,255,0.1), transparent 30%);
            animation: rotate 6s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .bmi-card > * {
            position: relative;
            z-index: 1;
        }

        .bmi-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .bmi-status {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .health-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        body.dark .metric-item {
            background: #334155;
        }

        .metric-item:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .metric-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }

        body.dark .metric-value {
            color: #e2e8f0;
        }

        .metric-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        body.dark .metric-label {
            color: #94a3b8;
        }

        .profile-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        body.dark .profile-info {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            border-color: #475569;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin: 0 auto 15px;
        }

        .profile-name {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        body.dark .profile-name {
            color: #e2e8f0;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            text-align: center;
        }

        .profile-stat {
            padding: 8px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
        }

        .profile-stat-value {
            font-weight: bold;
            color: #667eea;
        }

        .profile-stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        body.dark .profile-stat-label {
            color: #94a3b8;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            margin: 20px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.7);
            opacity: 0;
            transition: all 0.3s ease;
        }

        body.dark .modal-content {
            background: #1e293b;
            color: #e2e8f0;
        }

        .modal.show .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        body.dark .modal-header {
            border-bottom-color: #334155;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        body.dark .modal-title {
            color: #e2e8f0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #999;
            cursor: pointer;
            padding: 5px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark .close-btn:hover {
            background: #334155;
            color: #e2e8f0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        body.dark .form-group label {
            color: #e2e8f0;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            outline: none;
            transition: all 0.3s ease;
            font-size: 1rem;
            background: white;
        }

        body.dark .form-group input,
        body.dark .form-group select,
        body.dark .form-group textarea {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 3000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.error {
            background: #dc3545;
        }

        .claude-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        body.dark .claude-section {
            background: #1e293b;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .claude-response {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 12px;
            font-style: italic;
            color: #555;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
            line-height: 1.6;
            position: relative;
            overflow: hidden;
        }

        body.dark .claude-response {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            color: #e2e8f0;
        }

        .claude-response::before {
            content: '"';
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 3rem;
            color: #667eea;
            opacity: 0.3;
        }

        .ai-chat-container {
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 20px;
        }

        body.dark .ai-chat-container {
            border-color: #334155;
        }

        .ai-chat-messages {
            height: 350px;
            overflow-y: auto;
            padding: 20px;
            background: #fafafa;
        }

        body.dark .ai-chat-messages {
            background: #334155;
        }

        .ai-message {
            display: flex;
            margin-bottom: 20px;
            align-items: flex-start;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-message.user-message {
            flex-direction: row-reverse;
        }

        .ai-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin: 0 12px;
            flex-shrink: 0;
        }

        .ai-message:not(.user-message) .ai-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .ai-message.user-message .ai-avatar {
            background: #28a745;
            color: white;
        }

        .ai-text {
            background: white;
            padding: 15px 20px;
            border-radius: 18px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 75%;
            word-wrap: break-word;
            line-height: 1.5;
            position: relative;
        }

        body.dark .ai-text {
            background: #1e293b;
            color: #e2e8f0;
        }

        .ai-message.user-message .ai-text {
            background: #007bff;
            color: white;
        }

        .ai-input-container {
            display: flex;
            padding: 20px;
            background: white;
            border-top: 1px solid #f0f0f0;
        }

        body.dark .ai-input-container {
            background: #1e293b;
            border-top-color: #334155;
        }

        .ai-input-container input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            margin-right: 15px;
            transition: border-color 0.3s ease;
            background: white;
        }

        body.dark .ai-input-container input {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }

        .ai-input-container input:focus {
            border-color: #667eea;
        }

        .ai-send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .ai-send-btn:hover {
            transform: scale(1.05);
        }

        .ai-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 15px 20px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .quick-action {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        body.dark .quick-action {
            background: #334155;
        }

        .quick-action::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 50%;
            transition: all 0.6s ease;
            transform: translate(-50%, -50%);
        }

        .quick-action:hover::before {
            width: 300px;
            height: 300px;
        }

        .quick-action:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .quick-action .icon {
            font-size: 2rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .quick-action div:last-child {
            position: relative;
            z-index: 1;
        }

        .weekly-summary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .weekly-summary h3 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .summary-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .health-metrics {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10px;
                padding: 20px;
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 50px;
                height: 25px;
            }

            .theme-toggle::before {
                width: 21px;
                height: 21px;
                font-size: 10px;
            }

            body.dark .theme-toggle::before {
                transform: translateX(25px);
            }
        }
    </style>
</head>
<body>
    <div class="theme-toggle" onclick="toggleTheme()"></div>

    <div class="container">
        <div class="header">
            <h1>üçé MyDiet</h1>
            <p>AIÏôÄ Ìï®ÍªòÌïòÎäî Ïä§ÎßàÌä∏Ìïú Í±¥Í∞ï Í¥ÄÎ¶¨</p>
        </div>

        <div class="user-welcome">
            <h2 id="user-nickname-display">ÌÖåÏä§Ìä∏Ïú†Ï†ÄÎãò, ÏïàÎÖïÌïòÏÑ∏Ïöî! üëã</h2>
            <p id="goal-message">Î™©Ìëú Ï≤¥Ï§ë 65kgÏùÑ Ìñ•Ìï¥ Ìï®Íªò Îã¨Î†§Î¥êÏöî!</p>
            <button class="refresh-btn" onclick="refreshDashboard()">üîÑ ÏÉàÎ°úÍ≥†Ïπ®</button>
        </div>

        <div class="dashboard-grid">
            <div class="main-dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üçΩÔ∏è</div>
                        <div class="stat-value" id="meal-count">0</div>
                        <div class="stat-label">Ïò§Îäò ÏãùÎã® Í∏∞Î°ù</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üèÉ</div>
                        <div class="stat-value" id="workout-count">0</div>
                        <div class="stat-label">Ïò§Îäò Ïö¥Îèô Í∏∞Î°ù</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üòä</div>
                        <div class="stat-value" id="emotion-count">0</div>
                        <div class="stat-label">Í∞êÏ†ï Í∏∞Î°ù</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-value" id="goal-achievement">0%</div>
                        <div class="stat-label">Î™©Ìëú Îã¨ÏÑ±Î•†</div>
                    </div>
                </div>

                <div class="goal-progress">
                    <h3>üìä Ïò§ÎäòÏùò Î™©Ìëú Îã¨ÏÑ±Î•†</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="progress-text">Î™©Ìëú Îã¨ÏÑ±ÏùÑ ÏúÑÌï¥ ÌôîÏù¥ÌåÖ!</div>
                    
                    <div class="nutrition-overview">
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="total-calories">0</div>
                            <div class="nutrition-label">ÏÑ≠Ï∑® ÏπºÎ°úÎ¶¨</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="burned-calories">0</div>
                            <div class="nutrition-label">ÏÜåÎ™® ÏπºÎ°úÎ¶¨</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="net-calories">0</div>
                            <div class="nutrition-label">Ïàú ÏπºÎ°úÎ¶¨</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="water-intake">0L</div>
                            <div class="nutrition-label">ÏàòÎ∂Ñ ÏÑ≠Ï∑®</div>
                        </div>
                    </div>
                </div>

                <div class="main-content">
                    <div class="section-header">
                        <h3 class="section-title">üçΩÔ∏è Ïò§ÎäòÏùò ÏãùÎã®</h3>
                        <button class="add-btn" onclick="openMealModal()">+ ÏãùÎã® Ï∂îÍ∞Ä</button>
                    </div>
                    <div class="data-grid" id="meal-list">
                        <div class="empty-state">
                            <div class="emoji">üçΩÔ∏è</div>
                            <p>ÏïÑÏßÅ Í∏∞Î°ùÎêú ÏãùÎã®Ïù¥ ÏóÜÏäµÎãàÎã§</p>
                            <button class="add-btn" onclick="openMealModal()">Ï≤´ ÏãùÎã® Í∏∞Î°ùÌïòÍ∏∞</button>
                        </div>
                    </div>

                    <div class="section-header" style="margin-top: 40px;">
                        <h3 class="section-title">üèÉ Ïò§ÎäòÏùò Ïö¥Îèô</h3>
                        <button class="add-btn" onclick="openWorkoutModal()">+ Ïö¥Îèô Ï∂îÍ∞Ä</button>
                    </div>
                    <div class="data-grid" id="workout-list">
                        <div class="empty-state">
                            <div class="emoji">üèÉ</div>
                            <p>ÏïÑÏßÅ Í∏∞Î°ùÎêú Ïö¥ÎèôÏù¥ ÏóÜÏäµÎãàÎã§</p>
                            <button class="add-btn" onclick="openWorkoutModal()">Ï≤´ Ïö¥Îèô Í∏∞Î°ùÌïòÍ∏∞</button>
                        </div>
                    </div>

                    <div class="section-header" style="margin-top: 40px;">
                        <h3 class="section-title">üòä Ïò§ÎäòÏùò Í∞êÏ†ï</h3>
                        <button class="add-btn" onclick="openEmotionModal()">+ Í∞êÏ†ï Ï∂îÍ∞Ä</button>
                    </div>
                    <div class="data-grid" id="emotion-list">
                        <div class="empty-state">
                            <div class="emoji">üòä</div>
                            <p>ÏïÑÏßÅ Í∏∞Î°ùÎêú Í∞êÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§</p>
                            <button class="add-btn" onclick="openEmotionModal()">Ï≤´ Í∞êÏ†ï Í∏∞Î°ùÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="profile-info">
                    <div class="profile-avatar" id="profile-avatar">üë§</div>
                    <div class="profile-name" id="profile-name">ÌÖåÏä§Ìä∏ Ïú†Ï†Ä</div>
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profile-height">170cm</div>
                            <div class="profile-stat-label">ÌÇ§</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profile-age">25ÏÑ∏</div>
                            <div class="profile-stat-label">ÎÇòÏù¥</div>
                        </div>
                    </div>
                </div>

                <div class="bmi-card">
                    <h3>üìè BMI ÏßÄÏàò</h3>
                    <div class="bmi-value" id="bmi-value">22.5</div>
                    <div class="bmi-status" id="bmi-status">Ï†ïÏÉÅ Ï≤¥Ï§ë</div>
                    <div style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                        Í±¥Í∞ïÌïú Ï≤¥Ï§ëÏùÑ Ïú†ÏßÄÌïòÍ≥† ÏûàÏñ¥Ïöî! üëç
                    </div>
                </div>

                <div class="sidebar-card">
                    <h3 style="text-align: center; margin-bottom: 20px;">‚öñÔ∏è ÎÇòÏùò ÌòÑÏû¨ ÏÉÅÌÉú</h3>
                    
                    <div class="health-metrics">
                        <div class="metric-item">
                            <div class="metric-value" id="current-weight">70kg</div>
                            <div class="metric-label">ÌòÑÏû¨ Ï≤¥Ï§ë</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value" id="goal-weight">65kg</div>
                            <div class="metric-label">Î™©Ìëú Ï≤¥Ï§ë</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value" id="weight-diff">-5kg</div>
                            <div class="metric-label">ÎÇ®ÏùÄ Î™©Ìëú</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value" id="days-left">30Ïùº</div>
                            <div class="metric-label">Î™©Ìëú Í∏∞Í∞Ñ</div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="quick-action" onclick="openProfileModal()">
                            <div class="icon">‚öôÔ∏è</div>
                            <div>ÏÑ§Ï†ï</div>
                        </div>
                        <div class="quick-action" onclick="openWeightModal()">
                            <div class="icon">‚öñÔ∏è</div>
                            <div>Ï≤¥Ï§ëÍ∏∞Î°ù</div>
                        </div>
                        <div class="quick-action" onclick="deleteAllTodayData()" style="border-color: #dc3545;">
                            <div class="icon" style="color: #dc3545;">üóëÔ∏è</div>
                            <div style="color: #dc3545;">Ï†ÑÏ≤¥ÏÇ≠Ï†ú</div>
                        </div>
                    </div>
                </div>

                <div class="weekly-summary">
                    <h3>üìà Ïù¥Î≤à Ï£º ÏöîÏïΩ</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-value">1,850</div>
                            <div class="summary-label">ÌèâÍ∑† ÏπºÎ°úÎ¶¨</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">4Ìöå</div>
                            <div class="summary-label">Ïö¥Îèô ÌöüÏàò</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">80%</div>
                            <div class="summary-label">Î™©Ìëú Îã¨ÏÑ±</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">Ï¢ãÏùå</div>
                            <div class="summary-label">ÌèâÍ∑† Í∏∞Î∂Ñ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="claude-section">
            <h2 style="text-align: center; margin-bottom: 25px; color: #333;">ü§ñ Claude AI Í±¥Í∞ï ÏΩîÏπò</h2>
            
            <div class="claude-response" id="claude-response">
                Ïò§ÎäòÎèÑ Í±¥Í∞ïÌïú ÌïòÎ£®Î•º ÏúÑÌï¥ Ìï®ÍªòÌï¥Ïöî! Íæ∏Ï§ÄÌïú ÎÖ∏Î†•Ïù¥ ÏÑ±Í≥µÏùò Ïó¥Ïá†ÏûÖÎãàÎã§. üí™
            </div>
            
            <h3 style="margin-bottom: 15px; color: #333;">üí¨ ClaudeÏóêÍ≤å Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî</h3>
            <div class="ai-chat-container">
                <div id="ai-chat-messages" class="ai-chat-messages">
                    <div class="ai-message">
                        <div class="ai-avatar">ü§ñ</div>
                        <div class="ai-text">ÏïàÎÖïÌïòÏÑ∏Ïöî! Í±¥Í∞ï Í¥ÄÎ¶¨ÎÇò Îã§Ïù¥Ïñ¥Ìä∏Ïóê ÎåÄÌï¥ Í∂ÅÍ∏àÌïú Í≤ÉÏù¥ ÏûàÏúºÎ©¥ Ïñ∏Ï†úÎì† Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî! Ïò§ÎäòÏùò ÏãùÎã®Ïù¥ÎÇò Ïö¥Îèô Í≥ÑÌöçÏóê ÎåÄÌï¥ÏÑúÎèÑ Ï°∞Ïñ∏Ìï¥ÎìúÎ¶¥ Ïàò ÏûàÏñ¥Ïöî.</div>
                    </div>
                </div>
                <div class="ai-input-container">
                    <input type="text" id="ai-question-input" placeholder="ClaudeÏóêÍ≤å ÏßàÎ¨∏ÌïòÏÑ∏Ïöî... (Ïòà: Ïò§Îäò Î®πÏùÄ ÏùåÏãù Ïñ¥Îïå? / Îã§Ïù¥Ïñ¥Ìä∏ ÌåÅ ÏïåÎ†§Ï§ò)" onkeypress="handleEnterKey(event)">
                    <button class="ai-send-btn" onclick="askClaude()">Ï†ÑÏÜ°</button>
                </div>
            </div>
        </div>
    </div>

    <div id="mealModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üçΩÔ∏è ÏãùÎã® Í∏∞Î°ù</h2>
                <button class="close-btn" onclick="closeMealModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="meal-description">ÏãùÎã® ÏÑ§Î™Ö</label>
                <input type="text" id="meal-description" placeholder="Ïòà: ÏïÑÏπ® - ÌòÑÎØ∏Î∞•, ÍπÄÏπòÏ∞åÍ∞ú, Í≥ÑÎûÄÌõÑÎùºÏù¥" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="meal-calories">ÏπºÎ°úÎ¶¨ (kcal)</label>
                    <input type="number" id="meal-calories" placeholder="Ïòà: 450" min="1" required>
                </div>
                <div class="form-group">
                    <label for="meal-time">ÏãùÏÇ¨ ÏãúÍ∞Ñ</label>
                    <select id="meal-time">
                        <option value="ÏïÑÏπ®">ÏïÑÏπ®</option>
                        <option value="Ï†êÏã¨">Ï†êÏã¨</option>
                        <option value="Ï†ÄÎÖÅ">Ï†ÄÎÖÅ</option>
                        <option value="Í∞ÑÏãù">Í∞ÑÏãù</option>
                    </select>
                </div>
            </div>
            <button class="submit-btn" onclick="saveMeal()">ÏãùÎã® Í∏∞Î°ùÌïòÍ∏∞</button>
        </div>
    </div>

    <div id="workoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üèÉ Ïö¥Îèô Í∏∞Î°ù</h2>
                <button class="close-btn" onclick="closeWorkoutModal()">&times;</button>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="workout-type">Ïö¥Îèô Ï¢ÖÎ•ò</label>
                    <select id="workout-type" required>
                        <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                        <option value="Í±∑Í∏∞">Í±∑Í∏∞</option>
                        <option value="Ï°∞ÍπÖ">Ï°∞ÍπÖ</option>
                        <option value="Îã¨Î¶¨Í∏∞">Îã¨Î¶¨Í∏∞</option>
                        <option value="ÏûêÏ†ÑÍ±∞">ÏûêÏ†ÑÍ±∞</option>
                        <option value="ÏàòÏòÅ">ÏàòÏòÅ</option>
                        <option value="Ìó¨Ïä§">Ìó¨Ïä§ (Í∑ºÎ†•Ïö¥Îèô)</option>
                        <option value="ÏöîÍ∞Ä">ÏöîÍ∞Ä</option>
                        <option value="ÌïÑÎùºÌÖåÏä§">ÌïÑÎùºÌÖåÏä§</option>
                        <option value="Îì±ÏÇ∞">Îì±ÏÇ∞</option>
                        <option value="Ï∂ïÍµ¨">Ï∂ïÍµ¨</option>
                        <option value="ÎÜçÍµ¨">ÎÜçÍµ¨</option>
                        <option value="ÌÖåÎãàÏä§">ÌÖåÎãàÏä§</option>
                        <option value="Î∞∞ÎìúÎØºÌÑ¥">Î∞∞ÎìúÎØºÌÑ¥</option>
                        <option value="Í∏∞ÌÉÄ">Í∏∞ÌÉÄ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="workout-duration">ÏãúÍ∞Ñ (Î∂Ñ)</label>
                    <input type="number" id="workout-duration" placeholder="Ïòà: 30" min="1" required>
                </div>
            </div>
            <div class="form-group">
                <label for="workout-intensity">Ïö¥Îèô Í∞ïÎèÑ</label>
                <select id="workout-intensity">
                    <option value="ÎÇÆÏùå">ÎÇÆÏùå (Í∞ÄÎ≤ºÏö¥ Ïö¥Îèô)</option>
                    <option value="Î≥¥ÌÜµ" selected>Î≥¥ÌÜµ (Ï†ÅÎãπÌïú Ïö¥Îèô)</option>
                    <option value="ÎÜíÏùå">ÎÜíÏùå (Í≤©Î†¨Ìïú Ïö¥Îèô)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="workout-note">Ïö¥Îèô Î©îÎ™® (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                <textarea id="workout-note" placeholder="Ïö¥ÎèôÏóê ÎåÄÌïú Î©îÎ™®Î•º ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî..."></textarea>
            </div>
            <button class="submit-btn" onclick="saveWorkout()">Ïö¥Îèô Í∏∞Î°ùÌïòÍ∏∞</button>
        </div>
    </div>

    <div id="emotionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üòä Í∞êÏ†ï Í∏∞Î°ù</h2>
                <button class="close-btn" onclick="closeEmotionModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="emotion-mood">Ïò§ÎäòÏùò Í∏∞Î∂Ñ</label>
                <select id="emotion-mood" required>
                    <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                    <option value="Îß§Ïö∞ Ï¢ãÏùå">üòÑ Îß§Ïö∞ Ï¢ãÏùå</option>
                    <option value="Ï¢ãÏùå">üòä Ï¢ãÏùå</option>
                    <option value="Î≥¥ÌÜµ">üòê Î≥¥ÌÜµ</option>
                    <option value="ÎÇòÏÅ®">üòû ÎÇòÏÅ®</option>
                    <option value="Îß§Ïö∞ ÎÇòÏÅ®">üò¢ Îß§Ïö∞ ÎÇòÏÅ®</option>
                    <option value="Ïä§Ìä∏Î†àÏä§">üò§ Ïä§Ìä∏Î†àÏä§</option>
                    <option value="ÌîºÍ≥§Ìï®">üò¥ ÌîºÍ≥§Ìï®</option>
                    <option value="ÌôúÍ∏∞Ï∞∏">ü§ó ÌôúÍ∏∞Ï∞∏</option>
                    <option value="Ïö∞Ïö∏Ìï®">üòî Ïö∞Ïö∏Ìï®</option>
                    <option value="Î∂àÏïàÌï®">üò∞ Î∂àÏïàÌï®</option>
                </select>
            </div>
            <div class="form-group">
                <label for="emotion-energy">ÏóêÎÑàÏßÄ Î†àÎ≤® (1-10)</label>
                <input type="range" id="emotion-energy" min="1" max="10" value="5" oninput="updateEnergyValue(this.value)">
                <div style="text-align: center; margin-top: 5px;">
                    <span id="energy-value">5</span>/10
                </div>
            </div>
            <div class="form-group">
                <label for="emotion-note">Í∞êÏ†ï ÏùºÍ∏∞ (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                <textarea id="emotion-note" placeholder="Ïò§ÎäòÏùò Í∏∞Î∂ÑÏù¥ÎÇò ÏÉùÍ∞ÅÏùÑ ÏûêÏú†Î°≠Í≤å Ï†ÅÏñ¥Î≥¥ÏÑ∏Ïöî... 
Ïòà: Ïò§ÎäòÏùÄ Ïö¥ÎèôÏùÑ Ïó¥Ïã¨Ìûà Ìï¥ÏÑú Í∏∞Î∂ÑÏù¥ Ï¢ãÎã§. ÎÇ¥ÏùºÎèÑ Í≥ÑÏÜç ÌôîÏù¥ÌåÖ!"></textarea>
            </div>
            <button class="submit-btn" onclick="saveEmotion()">Í∞êÏ†ï Í∏∞Î°ùÌïòÍ∏∞</button>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è ÌîÑÎ°úÌïÑ ÏÑ§Ï†ï</h2>
                <button class="close-btn" onclick="closeProfileModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="user-nickname">ÎãâÎÑ§ÏûÑ</label>
                <input type="text" id="user-nickname" placeholder="ÏÇ¨Ïö©Ìï† ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
            </div>
            
            <div class="form-group">
                <label for="user-email">Ïù¥Î©îÏùº</label>
                <input type="email" id="user-email" placeholder="Ïù¥Î©îÏùº Ï£ºÏÜåÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="user-height">ÌÇ§ (cm)</label>
                    <input type="number" id="user-height" placeholder="Ïòà: 170" min="100" max="250" step="0.1">
                </div>
                <div class="form-group">
                    <label for="user-age">ÎÇòÏù¥</label>
                    <input type="number" id="user-age" placeholder="Ïòà: 25" min="15" max="100">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="current-weight-input">ÌòÑÏû¨ Ï≤¥Ï§ë (kg)</label>
                    <input type="number" id="current-weight-input" placeholder="Ïòà: 70" min="30" max="200" step="0.1">
                </div>
                <div class="form-group">
                    <label for="weight-goal">Î™©Ìëú Ï≤¥Ï§ë (kg)</label>
                    <input type="number" id="weight-goal" placeholder="Ïòà: 65" min="30" max="200" step="0.1" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="target-date">Î™©Ìëú Îã¨ÏÑ± ÎÇ†Ïßú</label>
                    <input type="date" id="target-date">
                </div>
                <div class="form-group">
                    <label for="activity-level">ÌôúÎèô ÏàòÏ§Ä</label>
                    <select id="activity-level">
                        <option value="ÎÇÆÏùå">ÎÇÆÏùå (ÏÇ¨Î¨¥ÏßÅ, Ïö¥Îèô Í±∞Ïùò ÏïàÌï®)</option>
                        <option value="Î≥¥ÌÜµ" selected>Î≥¥ÌÜµ (Í∞ÄÎ≤ºÏö¥ Ïö¥Îèô Ï£º 1-3Ìöå)</option>
                        <option value="ÎÜíÏùå">ÎÜíÏùå (Í∑úÏπôÏ†Å Ïö¥Îèô Ï£º 3-5Ìöå)</option>
                        <option value="Îß§Ïö∞ÎÜíÏùå">Îß§Ïö∞ ÎÜíÏùå (Îß§Ïùº Ïö¥Îèô/Ïú°Ï≤¥ÎÖ∏Îèô)</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="emotion-mode">Claude AI ÏÑ±Í≤© Î™®Îìú</label>
                <select id="emotion-mode" required>
                    <option value="Îã§Ï†ïÌï®">Îã§Ï†ïÌïòÍ≤å (ÏπúÍ∑ºÌïòÍ≥† Îî∞ÎúªÌï®) ü§ó</option>
                    <option value="Ï∏§Îç∞Î†à">Ï∏§Îç∞Î†à (ÍπåÏπ†ÌïòÏßÄÎßå Ïï†Ï†ïÏûàÍ≤å) üò§</option>
                    <option value="Î¨¥ÏûêÎπÑ">Î¨¥ÏûêÎπÑ (ÏóÑÍ≤©ÌïòÍ≥† ÏßÅÏÑ§Ï†Å) üòà</option>
                    <option value="Í≤©Î†§">Í≤©Î†§Ìòï (Ìï≠ÏÉÅ ÏùëÏõêÌïòÍ≥† ÎèôÍ∏∞Î∂ÄÏó¨) üí™</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="daily-goal-calories">ÏùºÏùº Î™©Ìëú ÏπºÎ°úÎ¶¨</label>
                <input type="number" id="daily-goal-calories" placeholder="Ïòà: 2000" min="1000" max="5000">
                <small style="color: #666; font-size: 0.8rem;">ÎπÑÏõåÎëêÎ©¥ ÏûêÎèôÏúºÎ°ú Í≥ÑÏÇ∞Îê©ÎãàÎã§</small>
            </div>
            
            <button class="submit-btn" onclick="saveProfile()">ÌîÑÎ°úÌïÑ Ï†ÄÏû•ÌïòÍ∏∞</button>
        </div>
    </div>

    <div id="weightModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚öñÔ∏è Ï≤¥Ï§ë Í∏∞Î°ù</h2>
                <button class="close-btn" onclick="closeWeightModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="weight-input">Ïò§ÎäòÏùò Ï≤¥Ï§ë (kg)</label>
                <input type="number" id="weight-input" placeholder="Ïòà: 69.5" min="30" max="200" step="0.1" required>
            </div>
            <div class="form-group">
                <label for="body-fat">Ï≤¥ÏßÄÎ∞©Î•† (%, ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                <input type="number" id="body-fat" placeholder="Ïòà: 15.5" min="3" max="50" step="0.1">
            </div>
            <div class="form-group">
                <label for="weight-note">Î©îÎ™® (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                <textarea id="weight-note" placeholder="Ï≤¥Ï§ë Î≥ÄÌôîÏóê ÎåÄÌïú Î©îÎ™®Î•º ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî..."></textarea>
            </div>
            <button class="submit-btn" onclick="saveWeight()">Ï≤¥Ï§ë Í∏∞Î°ùÌïòÍ∏∞</button>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        let currentData = {};
        let currentTheme = localStorage.getItem('theme') || 'light';

        document.addEventListener('DOMContentLoaded', function() {
            if (currentTheme === 'dark') {
                document.body.classList.add('dark');
            }
        });

        function toggleTheme() {
            document.body.classList.toggle('dark');
            currentTheme = document.body.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
        }

        function updateEnergyValue(value) {
            document.getElementById('energy-value').textContent = value;
        }

        function handleEnterKey(event) {
            if (event.key === 'Enter') {
                askClaude();
            }
        }

        window.addEventListener('load', function() {
            console.log('üöÄ Dashboard loading...');
            
            // Ï†ÑÏó≠ Î≥ÄÏàò Ï¥àÍ∏∞Ìôî
            window.currentUserId = 1;
            
            // ÏàúÏ∞®Ï†ÅÏúºÎ°ú Ïã§Ìñâ
            Promise.resolve()
                .then(() => {
                    console.log('1. Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± ÏãúÏûë...');
                    return createDefaultUser();
                })
                .then((userId) => {
                    if (userId) {
                        window.currentUserId = userId;
                        console.log(`‚úÖ ÏÇ¨Ïö©Ïûê ID ÏÑ§Ï†ï: ${userId}`);
                    }
                    console.log('2. ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑ Î°úÎìú ÏãúÏûë...');
                    return loadUserProfile();
                })
                .then(() => {
                    console.log('3. ÎåÄÏãúÎ≥¥Îìú ÌÜµÍ≥Ñ Î°úÎìú ÏãúÏûë...');
                    return loadDashboardStats();
                })
                .then(() => {
                    console.log('4. Ïò§Îäò Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÏûë...');
                    return loadTodayData();
                })
                .then(() => {
                    console.log('5. Claude ÏùëÎãµ Î°úÎìú ÏãúÏûë...');
                    return loadClaudeResponse();
                })
                .then(() => {
                    console.log('‚úÖ Î™®Îì† Ï¥àÍ∏∞Ìôî ÏôÑÎ£å!');
                })
                .catch(error => {
                    console.error('‚ùå Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•ò:', error);
                });
        });

        async function createDefaultUser() {
            try {
                console.log('üîç Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê ÌôïÏù∏ Ï§ë...');
                
                // Î®ºÏ†Ä Í∏∞Ï°¥ ÏÇ¨Ïö©Ïûê ÌôïÏù∏
                const checkResponse = await fetch('/api/user-check/list');
                if (checkResponse.ok) {
                    const result = await checkResponse.json();
                    console.log('üë• Í∏∞Ï°¥ ÏÇ¨Ïö©Ïûê Î™©Î°ù:', result);
                    
                    if (result.userCount > 0) {
                        console.log('‚úÖ Í∏∞Ï°¥ ÏÇ¨Ïö©Ïûê Ï°¥Ïû¨Ìï®, Ï≤´ Î≤àÏß∏ ÏÇ¨Ïö©Ïûê ÏÇ¨Ïö©');
                        const firstUser = result.users[0];
                        window.currentUserId = firstUser.id;
                        console.log(`üéØ ÏÇ¨Ïö©Ïûê ID ÏÑ§Ï†ï: ${firstUser.id} (${firstUser.nickname})`);
                        return firstUser.id;
                    }
                }
                
                console.log('üë§ Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± ÏãúÎèÑ...');
                const response = await fetch('/api/user-check/create-default', {
                    method: 'POST'
                });
                const result = await response.json();
                console.log('üéØ Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± Í≤∞Í≥º:', result);
                
                if (result.user) {
                    console.log('‚úÖ Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± ÏÑ±Í≥µ:', result.user);
                    showToast('Í∏∞Î≥∏ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!');
                    window.currentUserId = result.user.id;
                    return result.user.id;
                } else {
                    console.log('‚ö†Ô∏è Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± Ïã§Ìå®');
                    window.currentUserId = 1;
                    return 1;
                }
            } catch (error) {
                console.error('‚ùå Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± Ïò§Î•ò:', error);
                showToast('Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
                window.currentUserId = 1;
                return 1;
            }
        }

        async function loadUserProfile() {
            try {
                const response = await fetch('/api/user-check/get/1');
                if (response.ok) {
                    const data = await response.json();
                    console.log('User profile loaded:', data);
                    
                    const profile = data.user || data;
                    const nicknameEl = document.getElementById('user-nickname-display');
                    const goalEl = document.getElementById('goal-message');
                    const profileNameEl = document.getElementById('profile-name');
                    const profileHeightEl = document.getElementById('profile-height');
                    const profileAgeEl = document.getElementById('profile-age');
                    const profileAvatarEl = document.getElementById('profile-avatar');
                    
                    if (nicknameEl && profile.nickname) {
                        nicknameEl.textContent = `${profile.nickname}Îãò, ÏïàÎÖïÌïòÏÑ∏Ïöî! üëã`;
                        if (profileNameEl) profileNameEl.textContent = profile.nickname;
                    }
                    
                    if (goalEl && profile.weightGoal) {
                        goalEl.textContent = `Î™©Ìëú Ï≤¥Ï§ë ${profile.weightGoal}kgÏùÑ Ìñ•Ìï¥ Ìï®Íªò Îã¨Î†§Î¥êÏöî!`;
                    }

                    if (profile.height && profileHeightEl) {
                        profileHeightEl.textContent = profile.height + 'cm';
                    }

                    if (profile.age && profileAgeEl) {
                        profileAgeEl.textContent = profile.age + 'ÏÑ∏';
                    }

                    if (profileAvatarEl) {
                        const avatars = ['üë®', 'üë©', 'üßë', 'üë§', 'üòä', 'ü§ó', 'üí™'];
                        const randomAvatar = avatars[Math.floor(Math.random() * avatars.length)];
                        profileAvatarEl.textContent = randomAvatar;
                    }

                    updateHealthMetrics(profile);
                } else {
                    console.log('User not found, using default display');
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
            }
        }

        function updateHealthMetrics(profile) {
            const currentWeight = profile.currentWeight || 70;
            const goalWeight = profile.weightGoal || 65;
            const height = profile.height || 170;
            
            document.getElementById('current-weight').textContent = currentWeight + 'kg';
            document.getElementById('goal-weight').textContent = goalWeight + 'kg';
            
            const weightDiff = currentWeight - goalWeight;
            const weightDiffEl = document.getElementById('weight-diff');
            if (weightDiff > 0) {
                weightDiffEl.textContent = '-' + weightDiff.toFixed(1) + 'kg';
                weightDiffEl.style.color = '#dc3545';
            } else if (weightDiff < 0) {
                weightDiffEl.textContent = '+' + Math.abs(weightDiff).toFixed(1) + 'kg';
                weightDiffEl.style.color = '#28a745';
            } else {
                weightDiffEl.textContent = 'Î™©ÌëúÎã¨ÏÑ±!';
                weightDiffEl.style.color = '#28a745';
            }

            const bmi = (currentWeight / ((height/100) ** 2)).toFixed(1);
            document.getElementById('bmi-value').textContent = bmi;
            
            let bmiStatus = '';
            let bmiColor = '';
            if (bmi < 18.5) {
                bmiStatus = 'Ï†ÄÏ≤¥Ï§ë';
                bmiColor = '#ffc107';
            } else if (bmi < 25) {
                bmiStatus = 'Ï†ïÏÉÅ Ï≤¥Ï§ë';
                bmiColor = '#28a745';
            } else if (bmi < 30) {
                bmiStatus = 'Í≥ºÏ≤¥Ï§ë';
                bmiColor = '#fd7e14';
            } else {
                bmiStatus = 'ÎπÑÎßå';
                bmiColor = '#dc3545';
            }
            
            const bmiStatusEl = document.getElementById('bmi-status');
            bmiStatusEl.textContent = bmiStatus;
            bmiStatusEl.style.color = 'rgba(255,255,255,0.9)';

            if (profile.targetDate) {
                const targetDate = new Date(profile.targetDate);
                const today = new Date();
                const daysLeft = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));
                
                if (daysLeft > 0) {
                    document.getElementById('days-left').textContent = daysLeft + 'Ïùº';
                } else if (daysLeft === 0) {
                    document.getElementById('days-left').textContent = 'D-Day';
                } else {
                    document.getElementById('days-left').textContent = 'Í∏∞Í∞ÑÎßåÎ£å';
                }
            }
        }

        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/debug/all-data');
                if (response.ok) {
                    const data = await response.json();
                    console.log('üìä Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìúÎê®:', data);
                    
                    const today = new Date().toISOString().split('T')[0];
                    const mealCount = data.meals ? data.meals.filter(meal => 
                        meal.date === today || (meal.date && meal.date.startsWith(today))
                    ).length : 0;
                    const workoutCount = data.workouts ? data.workouts.filter(workout => 
                        workout.date === today || (workout.date && workout.date.startsWith(today))
                    ).length : 0;
                    const emotionCount = data.emotions ? data.emotions.filter(emotion => 
                        emotion.date === today || (emotion.date && emotion.date.startsWith(today))
                    ).length : 0;
                    
                    console.log('üìà Ïò§Îäò ÌÜµÍ≥Ñ:', { mealCount, workoutCount, emotionCount });
                    
                    animateValue('meal-count', 0, mealCount, 1000);
                    animateValue('workout-count', 0, workoutCount, 1200);
                    animateValue('emotion-count', 0, emotionCount, 1400);
                    
                    const achievement = Math.min(100, Math.round((mealCount * 30) + (workoutCount * 40) + (emotionCount * 30)));
                    setTimeout(() => {
                        document.getElementById('goal-achievement').textContent = achievement + '%';
                    }, 1600);
                    
                    const progressFill = document.getElementById('progress-fill');
                    const progressText = document.getElementById('progress-text');
                    
                    setTimeout(() => {
                        progressFill.style.width = achievement + '%';
                    }, 500);
                    
                    if (achievement >= 100) {
                        progressText.textContent = 'üéâ Ïò§Îäò Î™©ÌëúÎ•º ÏôÑÎ≤ΩÌïòÍ≤å Îã¨ÏÑ±ÌñàÏñ¥Ïöî!';
                    } else if (achievement >= 70) {
                        progressText.textContent = 'üí™ Î™©ÌëúÍπåÏßÄ Ï°∞Í∏àÎßå Îçî! ÌôîÏù¥ÌåÖ!';
                    } else if (achievement >= 40) {
                        progressText.textContent = 'üî• Ï¢ãÏùÄ ÌéòÏù¥Ïä§ÏòàÏöî! Í≥ÑÏÜç Ìï¥Î¥êÏöî!';
                    } else {
                        progressText.textContent = 'üå± Ïò§ÎäòÎèÑ Í±¥Í∞ïÌïú ÌïòÎ£®Î•º ÎßåÎì§Ïñ¥Í∞ÄÏöî!';
                    }

                    const totalCalories = data.meals ? data.meals
                        .filter(meal => meal.date === today || (meal.date && meal.date.startsWith(today)))
                        .reduce((sum, meal) => sum + (meal.caloriesEstimate || 0), 0) : 0;
                    const totalBurned = data.workouts ? data.workouts
                        .filter(workout => workout.date === today || (workout.date && workout.date.startsWith(today)))
                        .reduce((sum, workout) => sum + (workout.caloriesBurned || 0), 0) : 0;
                    
                    animateValue('total-calories', 0, totalCalories, 1000);
                    animateValue('burned-calories', 0, totalBurned, 1200);
                    setTimeout(() => {
                        document.getElementById('net-calories').textContent = totalCalories - totalBurned;
                    }, 1400);

                    const waterIntake = Math.random() * 2 + 1;
                    document.getElementById('water-intake').textContent = waterIntake.toFixed(1) + 'L';
                } else {
                    console.log('‚ùå ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', response.status);
                    showToast('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§', 'error');
                }
            } catch (error) {
                console.error('‚ùå ÎåÄÏãúÎ≥¥Îìú ÌÜµÍ≥Ñ Î°úÎìú Ïò§Î•ò:', error);
                showToast('ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
            }
        }

        function animateValue(id, start, end, duration) {
            const element = document.getElementById(id);
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.round(current);
            }, 16);
        }

        async function loadTodayData() {
            try {
                const response = await fetch('/api/debug/all-data');
                if (response.ok) {
                    const data = await response.json();
                    console.log('üìÖ Ïò§Îäò Îç∞Ïù¥ÌÑ∞ Î°úÎìú:', data);
                    
                    const today = new Date().toISOString().split('T')[0];
                    const todayMeals = data.meals ? data.meals.filter(meal => 
                        meal.date === today || (meal.date && meal.date.startsWith(today))
                    ) : [];
                    const todayWorkouts = data.workouts ? data.workouts.filter(workout => 
                        workout.date === today || (workout.date && workout.date.startsWith(today))
                    ) : [];
                    const todayEmotions = data.emotions ? data.emotions.filter(emotion => 
                        emotion.date === today || (emotion.date && emotion.date.startsWith(today))
                    ) : [];
                    
                    console.log('üîç ÌïÑÌÑ∞Îêú Ïò§Îäò Îç∞Ïù¥ÌÑ∞:', {
                        meals: todayMeals.length,
                        workouts: todayWorkouts.length,
                        emotions: todayEmotions.length
                    });
                    
                    displayMeals(todayMeals);
                    displayWorkouts(todayWorkouts);
                    displayEmotions(todayEmotions);
                    
                    currentData = {
                        meals: todayMeals,
                        workouts: todayWorkouts,
                        emotions: todayEmotions
                    };
                } else {
                    console.log('‚ùå Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®, Îπà ÏÉÅÌÉú ÌëúÏãú');
                    displayEmptyStates();
                }
            } catch (error) {
                console.error('‚ùå Ïò§Îäò Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïò§Î•ò:', error);
                displayEmptyStates();
                showToast('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
            }
        }

        function displayEmptyStates() {
            document.getElementById('meal-list').innerHTML = `
                <div class="empty-state">
                    <div class="emoji">üçΩÔ∏è</div>
                    <p>ÏïÑÏßÅ Í∏∞Î°ùÎêú ÏãùÎã®Ïù¥ ÏóÜÏäµÎãàÎã§</p>
                    <button class="add-btn" onclick="openMealModal()">Ï≤´ ÏãùÎã® Í∏∞Î°ùÌïòÍ∏∞</button>
                </div>
            `;
            document.getElementById('workout-list').innerHTML = `
                <div class="empty-state">
                    <div class="emoji">üèÉ</div>
                    <p>ÏïÑÏßÅ Í∏∞Î°ùÎêú Ïö¥ÎèôÏù¥ ÏóÜÏäµÎãàÎã§</p>
                    <button class="add-btn" onclick="openWorkoutModal()">Ï≤´ Ïö¥Îèô Í∏∞Î°ùÌïòÍ∏∞</button>
                </div>
            `;
            document.getElementById('emotion-list').innerHTML = `
                <div class="empty-state">
                    <div class="emoji">üòä</div>
                    <p>ÏïÑÏßÅ Í∏∞Î°ùÎêú Í∞êÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§</p>
                    <button class="add-btn" onclick="openEmotionModal()">Ï≤´ Í∞êÏ†ï Í∏∞Î°ùÌïòÍ∏∞</button>
                </div>
            `;
        }

        function displayMeals(meals) {
            const mealList = document.getElementById('meal-list');
            
            if (meals.length === 0) {
                mealList.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üçΩÔ∏è</div>
                        <p>ÏïÑÏßÅ Í∏∞Î°ùÎêú ÏãùÎã®Ïù¥ ÏóÜÏäµÎãàÎã§</p>
                        <button class="add-btn" onclick="openMealModal()">Ï≤´ ÏãùÎã® Í∏∞Î°ùÌïòÍ∏∞</button>
                    </div>
                `;
                return;
            }
            
            mealList.innerHTML = meals.map((meal, index) => {
                const mealTime = getMealTimeFromDescription(meal.description);
                const mealIcon = getMealIcon(mealTime);
                return `
                    <div class="data-card" style="animation-delay: ${index * 0.1}s">
                        <h4>${mealIcon} ${meal.description || 'ÏãùÎã®'}</h4>
                        <p>üî• ${meal.caloriesEstimate || 0} kcal | ‚è∞ ${getTimeAgo(meal.createdAt)}</p>
                        <div class="data-actions">
                            <button class="edit-btn" onclick="editMeal(${meal.id})">ÏàòÏ†ï</button>
                            <button class="delete-btn" onclick="deleteMeal(${meal.id})">ÏÇ≠Ï†ú</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayWorkouts(workouts) {
            const workoutList = document.getElementById('workout-list');
            
            if (workouts.length === 0) {
                workoutList.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üèÉ</div>
                        <p>ÏïÑÏßÅ Í∏∞Î°ùÎêú Ïö¥ÎèôÏù¥ ÏóÜÏäµÎãàÎã§</p>
                        <button class="add-btn" onclick="openWorkoutModal()">Ï≤´ Ïö¥Îèô Í∏∞Î°ùÌïòÍ∏∞</button>
                    </div>
                `;
                return;
            }
            
            workoutList.innerHTML = workouts.map((workout, index) => {
                const workoutIcon = getWorkoutIcon(workout.type);
                const intensityColor = getIntensityColor(workout.intensity);
                return `
                    <div class="data-card" style="animation-delay: ${index * 0.1}s">
                        <h4>${workoutIcon} ${workout.type || 'Ïö¥Îèô'}</h4>
                        <p>‚è±Ô∏è ${workout.duration || 0}Î∂Ñ | üî• ${workout.caloriesBurned || 0}kcal | <span style="color: ${intensityColor}">‚óè</span> ${workout.intensity || 'Î≥¥ÌÜµ'}</p>
                        <div class="data-actions">
                            <button class="edit-btn" onclick="editWorkout(${workout.id})">ÏàòÏ†ï</button>
                            <button class="delete-btn" onclick="deleteWorkout(${workout.id})">ÏÇ≠Ï†ú</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayEmotions(emotions) {
            const emotionList = document.getElementById('emotion-list');
            
            if (emotions.length === 0) {
                emotionList.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üòä</div>
                        <p>ÏïÑÏßÅ Í∏∞Î°ùÎêú Í∞êÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§</p>
                        <button class="add-btn" onclick="openEmotionModal()">Ï≤´ Í∞êÏ†ï Í∏∞Î°ùÌïòÍ∏∞</button>
                    </div>
                `;
                return;
            }
            
            emotionList.innerHTML = emotions.map((emotion, index) => {
                const moodEmoji = getMoodEmoji(emotion.mood);
                return `
                    <div class="data-card" style="animation-delay: ${index * 0.1}s">
                        <h4>${moodEmoji} ${emotion.mood || 'Í∏∞Î∂Ñ'}</h4>
                        <p>${emotion.note ? (emotion.note.length > 50 ? emotion.note.substring(0, 50) + '...' : emotion.note) : 'Î©îÎ™® ÏóÜÏùå'}</p>
                        <div class="data-actions">
                            <button class="edit-btn" onclick="editEmotion(${emotion.id})">ÏàòÏ†ï</button>
                            <button class="delete-btn" onclick="deleteEmotion(${emotion.id})">ÏÇ≠Ï†ú</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getMealTimeFromDescription(description) {
            if (!description) return 'ÏãùÏÇ¨';
            if (description.includes('ÏïÑÏπ®')) return 'ÏïÑÏπ®';
            if (description.includes('Ï†êÏã¨')) return 'Ï†êÏã¨';
            if (description.includes('Ï†ÄÎÖÅ')) return 'Ï†ÄÎÖÅ';
            if (description.includes('Í∞ÑÏãù')) return 'Í∞ÑÏãù';
            return 'ÏãùÏÇ¨';
        }

        function getMealIcon(mealTime) {
            const icons = {
                'ÏïÑÏπ®': 'üåÖ',
                'Ï†êÏã¨': '‚òÄÔ∏è',
                'Ï†ÄÎÖÅ': 'üåô',
                'Í∞ÑÏãù': 'üç™',
                'ÏãùÏÇ¨': 'üçΩÔ∏è'
            };
            return icons[mealTime] || 'üçΩÔ∏è';
        }

        function getWorkoutIcon(type) {
            const icons = {
                'Í±∑Í∏∞': 'üö∂',
                'Ï°∞ÍπÖ': 'üèÉ',
                'Îã¨Î¶¨Í∏∞': 'üèÉ‚Äç‚ôÇÔ∏è',
                'ÏûêÏ†ÑÍ±∞': 'üö¥',
                'ÏàòÏòÅ': 'üèä',
                'Ìó¨Ïä§': 'üí™',
                'ÏöîÍ∞Ä': 'üßò',
                'ÌïÑÎùºÌÖåÏä§': 'ü§∏',
                'Îì±ÏÇ∞': 'ü•æ',
                'Ï∂ïÍµ¨': '‚öΩ',
                'ÎÜçÍµ¨': 'üèÄ',
                'ÌÖåÎãàÏä§': 'üéæ',
                'Î∞∞ÎìúÎØºÌÑ¥': 'üè∏'
            };
            return icons[type] || 'üèÉ';
        }

        function getIntensityColor(intensity) {
            const colors = {
                'ÎÇÆÏùå': '#28a745',
                'Î≥¥ÌÜµ': '#ffc107',
                'ÎÜíÏùå': '#dc3545'
            };
            return colors[intensity] || '#6c757d';
        }

        function getMoodEmoji(mood) {
            const emojis = {
                'Îß§Ïö∞ Ï¢ãÏùå': 'üòÑ',
                'Ï¢ãÏùå': 'üòä',
                'Î≥¥ÌÜµ': 'üòê',
                'ÎÇòÏÅ®': 'üòû',
                'Îß§Ïö∞ ÎÇòÏÅ®': 'üò¢',
                'Ïä§Ìä∏Î†àÏä§': 'üò§',
                'ÌîºÍ≥§Ìï®': 'üò¥',
                'ÌôúÍ∏∞Ï∞∏': 'ü§ó',
                'Ïö∞Ïö∏Ìï®': 'üòî',
                'Î∂àÏïàÌï®': 'üò∞'
            };
            return emojis[mood] || 'üòä';
        }

        function getTimeAgo(timestamp) {
            if (!timestamp) return '';
            const now = new Date();
            const time = new Date(timestamp);
            const diff = Math.floor((now - time) / 1000 / 60);
            
            if (diff < 1) return 'Î∞©Í∏à Ï†Ñ';
            if (diff < 60) return `${diff}Î∂Ñ Ï†Ñ`;
            if (diff < 1440) return `${Math.floor(diff / 60)}ÏãúÍ∞Ñ Ï†Ñ`;
            return `${Math.floor(diff / 1440)}Ïùº Ï†Ñ`;
        }

        async function loadClaudeResponse() {
            try {
                const responses = [
                    "Ïò§ÎäòÎèÑ Í±¥Í∞ïÌïú ÌïòÎ£®Î•º ÏúÑÌï¥ Ìï®ÍªòÌï¥Ïöî! Íæ∏Ï§ÄÌïú ÎÖ∏Î†•Ïù¥ ÏÑ±Í≥µÏùò Ïó¥Ïá†ÏûÖÎãàÎã§. üí™",
                    "ÏûëÏùÄ Î≥ÄÌôîÍ∞Ä ÌÅ∞ Í≤∞Í≥ºÎ•º ÎßåÎì§Ïñ¥ÎÉÖÎãàÎã§. Ïò§Îäò Ìïú Í±∏ÏùåÏî© Î™©ÌëúÏóê Îã§Í∞ÄÍ∞ÄÍ≥† ÏûàÏñ¥Ïöî! üåü",
                    "Í±¥Í∞ïÌïú ÏãùÎã®Í≥º Íæ∏Ï§ÄÌïú Ïö¥ÎèôÏúºÎ°ú Îçî ÎÇòÏùÄ ÎÇ¥ÏùºÏùÑ ÎßåÎì§Ïñ¥Í∞ÄÏÑ∏Ïöî! üçé",
                    "ÎãπÏã†Ïùò ÎÖ∏Î†•ÏùÑ ÏùëÏõêÌï©ÎãàÎã§! Îß§Ïùº Ï°∞Í∏àÏî© ÏÑ±Ïû•ÌïòÎäî Î™®ÏäµÏù¥ ÏïÑÎ¶ÑÎã§ÏõåÏöî. üå±",
                    "Î™©ÌëúÎ•º Ìñ•Ìïú Ïó¨Ï†ïÏóêÏÑú Í∞ÄÏû• Ï§ëÏöîÌïú Í≤ÉÏùÄ ÏßÄÏÜçÏÑ±ÏûÖÎãàÎã§. Ìï®Íªò Ìï¥Î¥êÏöî! üöÄ"
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                document.getElementById('claude-response').innerHTML = randomResponse;
            } catch (error) {
                console.error('Error loading Claude response:', error);
                document.getElementById('claude-response').innerHTML = 'Í±¥Í∞ïÌïú ÌïòÎ£® Î≥¥ÎÇ¥ÏÑ∏Ïöî! üí™';
            }
        }

        function openMealModal() {
            const modal = document.getElementById('mealModal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeMealModal() {
            const modal = document.getElementById('mealModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                document.getElementById('meal-description').value = '';
                document.getElementById('meal-calories').value = '';
                document.getElementById('meal-time').value = 'ÏïÑÏπ®';
            }
        }

        function openWorkoutModal() {
            const modal = document.getElementById('workoutModal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeWorkoutModal() {
            const modal = document.getElementById('workoutModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                document.getElementById('workout-type').value = '';
                document.getElementById('workout-duration').value = '';
                document.getElementById('workout-intensity').value = 'Î≥¥ÌÜµ';
                document.getElementById('workout-note').value = '';
            }
        }

        function openEmotionModal() {
            const modal = document.getElementById('emotionModal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeEmotionModal() {
            const modal = document.getElementById('emotionModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                document.getElementById('emotion-mood').value = '';
                document.getElementById('emotion-energy').value = '5';
                document.getElementById('energy-value').textContent = '5';
                document.getElementById('emotion-note').value = '';
            }
        }

        function openProfileModal() {
            loadCurrentProfile();
            const modal = document.getElementById('profileModal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }

        function openWeightModal() {
            const modal = document.getElementById('weightModal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeWeightModal() {
            const modal = document.getElementById('weightModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                document.getElementById('weight-input').value = '';
                document.getElementById('body-fat').value = '';
                document.getElementById('weight-note').value = '';
            }
        }

        window.onclick = function(event) {
            const modals = ['mealModal', 'workoutModal', 'emotionModal', 'profileModal', 'weightModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal && event.target === modal) {
                    modal.classList.remove('show');
                    setTimeout(() => {
                        modal.style.display = 'none';
                    }, 300);
                }
            });
        };

        async function loadCurrentProfile() {
            try {
                const response = await fetch('/api/user-check/get/1');
                if (response.ok) {
                    const data = await response.json();
                    const profile = data.user || data;
                    
                    if (profile.nickname) document.getElementById('user-nickname').value = profile.nickname;
                    if (profile.email) document.getElementById('user-email').value = profile.email;
                    if (profile.height) document.getElementById('user-height').value = profile.height;
                    if (profile.age) document.getElementById('user-age').value = profile.age;
                    if (profile.currentWeight) document.getElementById('current-weight-input').value = profile.currentWeight;
                    if (profile.weightGoal) document.getElementById('weight-goal').value = profile.weightGoal;
                    if (profile.targetDate) document.getElementById('target-date').value = profile.targetDate;
                    if (profile.activityLevel) document.getElementById('activity-level').value = profile.activityLevel;
                    if (profile.emotionMode) document.getElementById('emotion-mode').value = profile.emotionMode;
                    if (profile.dailyGoalCalories) document.getElementById('daily-goal-calories').value = profile.dailyGoalCalories;
                }
            } catch (error) {
                console.error('Error loading current profile:', error);
            }
        }

        async function saveMeal() {
            const description = document.getElementById('meal-description').value.trim();
            const calories = parseInt(document.getElementById('meal-calories').value) || 0;
            const mealTime = document.getElementById('meal-time').value;
            
            if (!description) {
                showToast('ÏãùÎã® ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }
            
            if (calories <= 0) {
                showToast('ÏπºÎ°úÎ¶¨Î•º Ï†ïÌôïÌûà ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            const userId = window.currentUserId || 1;
            console.log('üíæ ÏãùÎã® Ï†ÄÏû• ÏãúÎèÑ:', {
                userId: userId,
                description: `${mealTime}: ${description}`,
                caloriesEstimate: calories
            });

            try {
                const response = await fetch('/api/debug/test-meal', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        userId: userId,
                        description: `${mealTime}: ${description}`,
                        caloriesEstimate: calories
                    })
                });

                console.log('üì° ÏùëÎãµ ÏÉÅÌÉú:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('üì• ÏÑúÎ≤Ñ ÏùëÎãµ:', result);
                
                if (result.success || result.savedMeal) {
                    showToast('üçΩÔ∏è ÏãùÎã®Ïù¥ Í∏∞Î°ùÎêòÏóàÏäµÎãàÎã§!');
                    closeMealModal();
                    setTimeout(() => {
                        refreshDashboard();
                    }, 1000);
                } else {
                    showToast('Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + (result.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
                }
            } catch (error) {
                console.error('‚ùå ÏãùÎã® Ï†ÄÏû• Ïò§Î•ò:', error);
                showToast(`API Ïò§Î•ò: ${error.message}`, 'error');
            }
        }

        async function saveWorkout() {
            const type = document.getElementById('workout-type').value;
            const duration = parseInt(document.getElementById('workout-duration').value) || 0;
            const intensity = document.getElementById('workout-intensity').value;
            const note = document.getElementById('workout-note').value.trim();
            
            if (!type) {
                showToast('Ïö¥Îèô Ï¢ÖÎ•òÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }
            
            if (duration <= 0) {
                showToast('Ïö¥Îèô ÏãúÍ∞ÑÏùÑ Ï†ïÌôïÌûà ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            const calorieRates = {
                'Í±∑Í∏∞': { 'ÎÇÆÏùå': 3, 'Î≥¥ÌÜµ': 4, 'ÎÜíÏùå': 5 },
                'Ï°∞ÍπÖ': { 'ÎÇÆÏùå': 6, 'Î≥¥ÌÜµ': 8, 'ÎÜíÏùå': 10 },
                'Îã¨Î¶¨Í∏∞': { 'ÎÇÆÏùå': 8, 'Î≥¥ÌÜµ': 12, 'ÎÜíÏùå': 15 },
                'ÏûêÏ†ÑÍ±∞': { 'ÎÇÆÏùå': 5, 'Î≥¥ÌÜµ': 7, 'ÎÜíÏùå': 10 },
                'ÏàòÏòÅ': { 'ÎÇÆÏùå': 7, 'Î≥¥ÌÜµ': 10, 'ÎÜíÏùå': 13 },
                'Ìó¨Ïä§': { 'ÎÇÆÏùå': 4, 'Î≥¥ÌÜµ': 6, 'ÎÜíÏùå': 8 },
                'ÏöîÍ∞Ä': { 'ÎÇÆÏùå': 2, 'Î≥¥ÌÜµ': 3, 'ÎÜíÏùå': 4 },
                'ÌïÑÎùºÌÖåÏä§': { 'ÎÇÆÏùå': 3, 'Î≥¥ÌÜµ': 4, 'ÎÜíÏùå': 5 },
                'Îì±ÏÇ∞': { 'ÎÇÆÏùå': 6, 'Î≥¥ÌÜµ': 8, 'ÎÜíÏùå': 12 },
                'Ï∂ïÍµ¨': { 'ÎÇÆÏùå': 7, 'Î≥¥ÌÜµ': 10, 'ÎÜíÏùå': 13 },
                'ÎÜçÍµ¨': { 'ÎÇÆÏùå': 6, 'Î≥¥ÌÜµ': 9, 'ÎÜíÏùå': 12 },
                'ÌÖåÎãàÏä§': { 'ÎÇÆÏùå': 5, 'Î≥¥ÌÜµ': 7, 'ÎÜíÏùå': 10 },
                'Î∞∞ÎìúÎØºÌÑ¥': { 'ÎÇÆÏùå': 4, 'Î≥¥ÌÜµ': 6, 'ÎÜíÏùå': 8 }
            };

            const rate = calorieRates[type] ? calorieRates[type][intensity] : 5;
            const caloriesBurned = Math.round(rate * duration);
            const userId = window.currentUserId || 1;

            console.log('üíæ Ïö¥Îèô Ï†ÄÏû• ÏãúÎèÑ:', {
                userId: userId,
                type: type,
                duration: duration,
                intensity: intensity,
                caloriesBurned: caloriesBurned
            });

            try {
                const response = await fetch('/api/debug/test-workout', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        userId: userId,
                        type: type,
                        duration: duration,
                        intensity: intensity,
                        caloriesBurned: caloriesBurned,
                        note: note
                    })
                });

                console.log('üì° Ïö¥Îèô ÏùëÎãµ ÏÉÅÌÉú:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.log('‚ùå ÏùëÎãµ ÏóêÎü¨:', errorText);
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('üì• Ïö¥Îèô ÏÑúÎ≤Ñ ÏùëÎãµ:', result);
                
                if (result.success || result.savedWorkout) {
                    showToast(`üèÉ Ïö¥ÎèôÏù¥ Í∏∞Î°ùÎêòÏóàÏäµÎãàÎã§! (${caloriesBurned}kcal ÏÜåÎ™®)`);
                    closeWorkoutModal();
                    setTimeout(() => {
                        refreshDashboard();
                    }, 1000);
                } else {
                    showToast('Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + (result.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
                }
            } catch (error) {
                console.error('‚ùå Ïö¥Îèô Ï†ÄÏû• Ïò§Î•ò:', error);
                showToast(`Ïö¥Îèô Ï†ÄÏû• Ïã§Ìå®: ${error.message}`, 'error');
            }
        }

        async function saveEmotion() {
            const mood = document.getElementById('emotion-mood').value;
            const energy = document.getElementById('emotion-energy').value;
            const note = document.getElementById('emotion-note').value.trim();
            
            if (!mood) {
                showToast('Í∏∞Î∂ÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            console.log('üíæ Í∞êÏ†ï Ï†ÄÏû• ÏãúÎèÑ:', {
                userId: 1,
                mood: mood,
                energyLevel: parseInt(energy),
                note: note
            });

            try {
                // IntegratedSaveControllerÏùò Ïã§Ï†ú Í≤ΩÎ°ú ÏÇ¨Ïö©
                const response = await fetch('/api/integrated/emotion', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        userId: 1,
                        mood: mood,
                        energyLevel: parseInt(energy),
                        note: note
                    })
                });

                console.log('üì° Í∞êÏ†ï ÏùëÎãµ ÏÉÅÌÉú:', response.status);
                
                if (!response.ok) {
                    // 404 ÏóêÎü¨Ïù∏ Í≤ΩÏö∞ Îã§Î•∏ Í≤ΩÎ°ú ÏãúÎèÑ
                    console.log('‚ùå Ï≤´ Î≤àÏß∏ API Ïã§Ìå®, Îã§Î•∏ Í≤ΩÎ°ú ÏãúÎèÑ...');
                    
                    // SaveDebugControllerÏóê Í∞êÏ†ï Ï†ÄÏû•Ïù¥ ÏóÜÏúºÎØÄÎ°ú ÏûÑÏãúÎ°ú Îã§Î•∏ Î∞©Ïãù ÏãúÎèÑ
                    const result = {
                        success: false,
                        error: `API not found (${response.status})`
                    };
                    
                    throw new Error(`HTTP ${response.status}: API Í≤ΩÎ°úÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§`);
                }
                
                const result = await response.json();
                console.log('üì• Í∞êÏ†ï ÏÑúÎ≤Ñ ÏùëÎãµ:', result);
                
                if (result.success || result.emotion) {
                    showToast('üòä Í∞êÏ†ïÏù¥ Í∏∞Î°ùÎêòÏóàÏäµÎãàÎã§!');
                    closeEmotionModal();
                    setTimeout(() => {
                        refreshDashboard();
                    }, 1000);
                } else {
                    showToast('Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + (result.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
                }
            } catch (error) {
                console.error('‚ùå Í∞êÏ†ï Ï†ÄÏû• Ïò§Î•ò:', error);
                showToast('Í∞êÏ†ï Ï†ÄÏû• APIÍ∞Ä Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏäµÎãàÎã§. Î∞±ÏóîÎìú ÌôïÏù∏ ÌïÑÏöî!', 'error');
            }
        }

        async function saveProfile() {
            const nickname = document.getElementById('user-nickname').value.trim();
            const email = document.getElementById('user-email').value.trim();
            const height = parseFloat(document.getElementById('user-height').value) || 0;
            const age = parseInt(document.getElementById('user-age').value) || 0;
            const currentWeight = parseFloat(document.getElementById('current-weight-input').value) || 0;
            const weightGoal = parseFloat(document.getElementById('weight-goal').value) || 0;
            const targetDate = document.getElementById('target-date').value;
            const activityLevel = document.getElementById('activity-level').value;
            const emotionMode = document.getElementById('emotion-mode').value;
            const dailyGoalCalories = parseInt(document.getElementById('daily-goal-calories').value) || 0;
            
            if (!nickname) {
                showToast('ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }
            
            if (!weightGoal) {
                showToast('Î™©Ìëú Ï≤¥Ï§ëÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            try {
                localStorage.setItem('userProfile', JSON.stringify({
                    nickname: nickname,
                    email: email,
                    height: height,
                    age: age,
                    currentWeight: currentWeight,
                    weightGoal: weightGoal,
                    targetDate: targetDate,
                    activityLevel: activityLevel,
                    emotionMode: emotionMode,
                    dailyGoalCalories: dailyGoalCalories > 0 ? dailyGoalCalories : null
                }));

                showToast('‚öôÔ∏è ÌîÑÎ°úÌïÑÏù¥ ÏûÑÏãú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§! (Î∞±ÏóîÎìú API Í∞úÎ∞ú ÌïÑÏöî)');
                closeProfileModal();
                setTimeout(() => {
                    refreshDashboard();
                }, 1000);
            } catch (error) {
                showToast('Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
                console.error('Error:', error);
            }
        }

        async function saveWeight() {
            const weight = parseFloat(document.getElementById('weight-input').value) || 0;
            const bodyFat = parseFloat(document.getElementById('body-fat').value) || null;
            const note = document.getElementById('weight-note').value.trim();
            
            if (weight <= 0) {
                showToast('Ï≤¥Ï§ëÏùÑ Ï†ïÌôïÌûà ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            try {
                const updateResponse = await fetch('/api/user-check/update/1', {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        currentWeight: weight
                    })
                });

                if (updateResponse.ok) {
                    showToast('‚öñÔ∏è Ï≤¥Ï§ëÏù¥ Í∏∞Î°ùÎêòÏóàÏäµÎãàÎã§!');
                    closeWeightModal();
                    setTimeout(() => {
                        refreshDashboard();
                    }, 1000);
                } else {
                    showToast('Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§', 'error');
                }
            } catch (error) {
                showToast('ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
                console.error('Error:', error);
            }
        }

        async function askClaude() {
            const input = document.getElementById('ai-question-input');
            const question = input.value.trim();
            
            if (!question) {
                showToast('ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            addChatMessage(question, true);
            input.value = '';
            showTypingIndicator();

            try {
                const response = await fetch('/api/chat/ask', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        question: question,
                        userId: 1
                    })
                });

                const result = await response.json();
                hideTypingIndicator();

                if (result.success) {
                    addChatMessage(result.response, false);
                } else {
                    addChatMessage('Ï£ÑÏÜ°Ìï©ÎãàÎã§. ÏùºÏãúÏ†ÅÏù∏ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.', false);
                }
            } catch (error) {
                hideTypingIndicator();
                addChatMessage('ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.', false);
                console.error('Error:', error);
            }
        }

        function addChatMessage(message, isUser) {
            const messagesContainer = document.getElementById('ai-chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `ai-message ${isUser ? 'user-message' : ''}`;
            
            messageDiv.innerHTML = `
                <div class="ai-avatar">${isUser ? 'üë§' : 'ü§ñ'}</div>
                <div class="ai-text">${message}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('ai-chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'ai-message typing-indicator';
            typingDiv.id = 'typing-indicator';
            
            typingDiv.innerHTML = `
                <div class="ai-avatar">ü§ñ</div>
                <div class="ai-text">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function deleteMeal(id) {
            if (!confirm('Ïù¥ ÏãùÎã® Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                const response = await fetch(`/api/delete/meal/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showToast('üóëÔ∏è ÏãùÎã® Í∏∞Î°ùÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
                    refreshDashboard();
                } else {
                    showToast('ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + (result.message || result.error), 'error');
                }
            } catch (error) {
                showToast('ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
                console.error('Error:', error);
            }
        }

        async function deleteWorkout(id) {
            if (!confirm('Ïù¥ Ïö¥Îèô Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                const response = await fetch(`/api/delete/workout/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showToast('üóëÔ∏è Ïö¥Îèô Í∏∞Î°ùÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
                    refreshDashboard();
                } else {
                    showToast('ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + (result.message || result.error), 'error');
                }
            } catch (error) {
                showToast('ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
                console.error('Error:', error);
            }
        }

        async function deleteEmotion(id) {
            if (!confirm('Ïù¥ Í∞êÏ†ï Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                const response = await fetch(`/api/delete/emotion/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showToast('üóëÔ∏è Í∞êÏ†ï Í∏∞Î°ùÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
                    refreshDashboard();
                } else {
                    showToast('ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + (result.message || result.error), 'error');
                }
            } catch (error) {
                showToast('ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
                console.error('Error:', error);
            }
        }

        function editMeal(id) {
            showToast('Ìé∏Ïßë Í∏∞Îä•ÏùÄ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§', 'error');
        }

        function editWorkout(id) {
            showToast('Ìé∏Ïßë Í∏∞Îä•ÏùÄ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§', 'error');
        }

        function editEmotion(id) {
            showToast('Ìé∏Ïßë Í∏∞Îä•ÏùÄ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§', 'error');
        }

        async function deleteAllTodayData() {
            if (!confirm('‚ö†Ô∏è Ïò§ÎäòÏùò Î™®Îì† Îç∞Ïù¥ÌÑ∞(ÏãùÎã®, Ïö¥Îèô, Í∞êÏ†ï)Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§!')) return;

            try {
                const response = await fetch('/api/delete/all/today', {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showToast(`üóëÔ∏è ${result.message}`, 'success');
                    refreshDashboard();
                } else {
                    showToast('ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + (result.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
                }
            } catch (error) {
                showToast('ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
                console.error('Error:', error);
            }
        }

        async function refreshDashboard() {
            showToast('Îç∞Ïù¥ÌÑ∞Î•º ÏÉàÎ°úÍ≥†Ïπ®ÌïòÍ≥† ÏûàÏäµÎãàÎã§...');
            
            try {
                await Promise.all([
                    loadUserProfile(),
                    loadDashboardStats(),
                    loadTodayData(),
                    loadClaudeResponse()
                ]);
                
                showToast('ÏÉàÎ°úÍ≥†Ïπ® ÏôÑÎ£å!');
            } catch (error) {
                showToast('ÏÉàÎ°úÍ≥†Ïπ® Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
                console.error('Error:', error);
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const openModal = document.querySelector('.modal.show');
                if (openModal) {
                    openModal.classList.remove('show');
                    setTimeout(() => {
                        openModal.style.display = 'none';
                    }, 300);
                }
            }
        });

        function showRandomTip() {
            const tips = [
                "üí° Î¨ºÏùÑ Ï∂©Î∂ÑÌûà ÎßàÏãúÎ©¥ Ïã†ÏßÑÎåÄÏÇ¨Í∞Ä Ìñ•ÏÉÅÎê©ÎãàÎã§!",
                "üçé ÌïòÎ£®Ïóê Í≥ºÏùº 2-3Í∞ú Ï†ïÎèÑÍ∞Ä Ï†ÅÎãπÌï©ÎãàÎã§!",
                "üèÉ‚Äç‚ôÇÔ∏è ÏùºÏ£ºÏùºÏóê 150Î∂Ñ Ïù¥ÏÉÅ Ïö¥ÎèôÌïòÎäî Í≤ÉÏùÑ Î™©ÌëúÎ°ú Ìï¥Î≥¥ÏÑ∏Ïöî!",
                "üò¥ Ï∂©Î∂ÑÌïú ÏàòÎ©¥ÏùÄ Ï≤¥Ï§ë Í¥ÄÎ¶¨Ïóê Îß§Ïö∞ Ï§ëÏöîÌï©ÎãàÎã§!",
                "ü•ó Îã§ÏñëÌïú ÏÉâÍπîÏùò Ï±ÑÏÜåÎ•º ÎìúÏÑ∏Ïöî!",
                "üí™ Í∑ºÎ†• Ïö¥ÎèôÎèÑ Ïú†ÏÇ∞ÏÜå Ïö¥ÎèôÎßåÌÅº Ï§ëÏöîÌï©ÎãàÎã§!",
                "üßò‚Äç‚ôÄÔ∏è Ïä§Ìä∏Î†àÏä§ Í¥ÄÎ¶¨ÎèÑ Í±¥Í∞ïÌïú Îã§Ïù¥Ïñ¥Ìä∏Ïùò ÌïµÏã¨ÏûÖÎãàÎã§!"
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            setTimeout(() => {
                showToast(randomTip);
            }, 5000);
        }

        setTimeout(showRandomTip, 10000);
    </script>
</body>
</html>